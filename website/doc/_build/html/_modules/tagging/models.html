<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tagging.models &mdash; obp 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="obp 0.0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for tagging.models</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Models and managers for generic tagging.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c"># Python 2.3 compatibility</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">set</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span>

<span class="kn">from</span> <span class="nn">django.contrib.contenttypes</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.query</span> <span class="kn">import</span> <span class="n">QuerySet</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">tagging</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">tagging.utils</span> <span class="kn">import</span> <span class="n">calculate_cloud</span><span class="p">,</span> <span class="n">get_tag_list</span><span class="p">,</span> <span class="n">get_queryset_and_model</span><span class="p">,</span> <span class="n">parse_tag_input</span>
<span class="kn">from</span> <span class="nn">tagging.utils</span> <span class="kn">import</span> <span class="n">LOGARITHMIC</span>

<span class="n">qn</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">quote_name</span>

<span class="c">############</span>
<span class="c"># Managers #</span>
<span class="c">############</span>

<div class="viewcode-block" id="TagManager"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager">[docs]</a><span class="k">class</span> <span class="nc">TagManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<div class="viewcode-block" id="TagManager.update_tags"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.update_tags">[docs]</a>    <span class="k">def</span> <span class="nf">update_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">tag_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update tags associated with an object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">current_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items__content_type__pk</span><span class="o">=</span><span class="n">ctype</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                                        <span class="n">items__object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">updated_tag_names</span> <span class="o">=</span> <span class="n">parse_tag_input</span><span class="p">(</span><span class="n">tag_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">FORCE_LOWERCASE_TAGS</span><span class="p">:</span>
            <span class="n">updated_tag_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">updated_tag_names</span><span class="p">]</span>

        <span class="c"># Remove tags which no longer apply</span>
        <span class="n">tags_for_removal</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">current_tags</span> \
                            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">updated_tag_names</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags_for_removal</span><span class="p">):</span>
            <span class="n">TaggedItem</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type__pk</span><span class="o">=</span><span class="n">ctype</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                                               <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                                               <span class="n">tag__in</span><span class="o">=</span><span class="n">tags_for_removal</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="c"># Add new tags</span>
        <span class="n">current_tag_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">current_tags</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">updated_tag_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_tag_names</span><span class="p">:</span>
                <span class="n">tag</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag_name</span><span class="p">)</span>
                <span class="n">TaggedItem</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TagManager.add_tag"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.add_tag">[docs]</a>    <span class="k">def</span> <span class="nf">add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Associates the given object with a tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tag_names</span> <span class="o">=</span> <span class="n">parse_tag_input</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;No tags were given: &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tag_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Multiple tags were given: &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tag_name</span><span class="p">)</span>
        <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">FORCE_LOWERCASE_TAGS</span><span class="p">:</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">tag</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">TaggedItem</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">ctype</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TagManager.get_for_object"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.get_for_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_for_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a queryset matching all tags associated with the given</span>
<span class="sd">        object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items__content_type__pk</span><span class="o">=</span><span class="n">ctype</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                           <span class="n">items__object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra_joins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra_criteria</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the custom SQL query for ``usage_for_model`` and</span>
<span class="sd">        ``usage_for_queryset``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">model_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="n">model_pk</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_table</span><span class="p">,</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">column</span><span class="p">))</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT DISTINCT </span><span class="si">%(tag)s</span><span class="s">.id, </span><span class="si">%(tag)s</span><span class="s">.name</span><span class="si">%(count_sql)s</span><span class="s"></span>
<span class="s">        FROM</span>
<span class="s">            </span><span class="si">%(tag)s</span><span class="s"></span>
<span class="s">            INNER JOIN </span><span class="si">%(tagged_item)s</span><span class="s"></span>
<span class="s">                ON </span><span class="si">%(tag)s</span><span class="s">.id = </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id</span>
<span class="s">            INNER JOIN </span><span class="si">%(model)s</span><span class="s"></span>
<span class="s">                ON </span><span class="si">%(tagged_item)s</span><span class="s">.object_id = </span><span class="si">%(model_pk)s</span><span class="s"></span>
<span class="s">            </span><span class="si">%%</span><span class="s">s</span>
<span class="s">        WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">            </span><span class="si">%%</span><span class="s">s</span>
<span class="s">        GROUP BY </span><span class="si">%(tag)s</span><span class="s">.id, </span><span class="si">%(tag)s</span><span class="s">.name</span>
<span class="s">        </span><span class="si">%%</span><span class="s">s</span>
<span class="s">        ORDER BY </span><span class="si">%(tag)s</span><span class="s">.name ASC&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s">&#39;tag&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;count_sql&#39;</span><span class="p">:</span> <span class="n">counts</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;, COUNT(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">model_pk</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;tagged_item&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="n">TaggedItem</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">model_table</span><span class="p">,</span>
            <span class="s">&#39;model_pk&#39;</span><span class="p">:</span> <span class="n">model_pk</span><span class="p">,</span>
            <span class="s">&#39;content_type_id&#39;</span><span class="p">:</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">min_count_sql</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">min_count_sql</span> <span class="o">=</span> <span class="s">&#39;HAVING COUNT(</span><span class="si">%s</span><span class="s">) &gt;= </span><span class="si">%%</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="n">model_pk</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_count</span><span class="p">)</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span> <span class="o">%</span> <span class="p">(</span><span class="n">extra_joins</span><span class="p">,</span> <span class="n">extra_criteria</span><span class="p">,</span> <span class="n">min_count_sql</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">counts</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tags</span>

<div class="viewcode-block" id="TagManager.usage_for_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.usage_for_model">[docs]</a>    <span class="k">def</span> <span class="nf">usage_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a list of tags associated with instances of the given</span>
<span class="sd">        Model class.</span>

<span class="sd">        If ``counts`` is True, a ``count`` attribute will be added to</span>
<span class="sd">        each tag, indicating how many times it has been used against</span>
<span class="sd">        the Model class in question.</span>

<span class="sd">        If ``min_count`` is given, only tags which have a ``count``</span>
<span class="sd">        greater than or equal to ``min_count`` will be returned.</span>
<span class="sd">        Passing a value for ``min_count`` implies ``counts=True``.</span>

<span class="sd">        To limit the tags (and counts, if specified) returned to those</span>
<span class="sd">        used by a subset of the Model&#39;s instances, pass a dictionary</span>
<span class="sd">        of field lookups to be applied to the given Model as the</span>
<span class="sd">        ``filters`` argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">queryset</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage_for_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">min_count</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">usage</span>
</div>
<div class="viewcode-block" id="TagManager.usage_for_queryset"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.usage_for_queryset">[docs]</a>    <span class="k">def</span> <span class="nf">usage_for_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a list of tags associated with instances of a model</span>
<span class="sd">        contained in the given queryset.</span>

<span class="sd">        If ``counts`` is True, a ``count`` attribute will be added to</span>
<span class="sd">        each tag, indicating how many times it has been used against</span>
<span class="sd">        the Model class in question.</span>

<span class="sd">        If ``min_count`` is given, only tags which have a ``count``</span>
<span class="sd">        greater than or equal to ``min_count`` will be returned.</span>
<span class="sd">        Passing a value for ``min_count`` implies ``counts=True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="s">&#39;get_compiler&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># Django 1.2+</span>
            <span class="n">compiler</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_compiler</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
            <span class="n">extra_joins</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">compiler</span><span class="o">.</span><span class="n">get_from_clause</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">where</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">as_sql</span><span class="p">(</span>
                <span class="n">compiler</span><span class="o">.</span><span class="n">quote_name_unless_alias</span><span class="p">,</span> <span class="n">compiler</span><span class="o">.</span><span class="n">connection</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Django pre-1.2</span>
            <span class="n">extra_joins</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_from_clause</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">where</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">as_sql</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">where</span><span class="p">:</span>
            <span class="n">extra_criteria</span> <span class="o">=</span> <span class="s">&#39;AND </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">where</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extra_criteria</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">min_count</span><span class="p">,</span> <span class="n">extra_joins</span><span class="p">,</span> <span class="n">extra_criteria</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TagManager.related_for_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.related_for_model">[docs]</a>    <span class="k">def</span> <span class="nf">related_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a list of tags related to a given list of tags - that</span>
<span class="sd">        is, other tags used by items which have all the given tags.</span>

<span class="sd">        If ``counts`` is True, a ``count`` attribute will be added to</span>
<span class="sd">        each tag, indicating the number of items which have it in</span>
<span class="sd">        addition to the given list of tags.</span>

<span class="sd">        If ``min_count`` is given, only tags which have a ``count``</span>
<span class="sd">        greater than or equal to ``min_count`` will be returned.</span>
<span class="sd">        Passing a value for ``min_count`` implies ``counts=True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">get_tag_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tag_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tagged_item_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">TaggedItem</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT </span><span class="si">%(tag)s</span><span class="s">.id, </span><span class="si">%(tag)s</span><span class="s">.name</span><span class="si">%(count_sql)s</span><span class="s"></span>
<span class="s">        FROM </span><span class="si">%(tagged_item)s</span><span class="s"> INNER JOIN </span><span class="si">%(tag)s</span><span class="s"> ON </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id = </span><span class="si">%(tag)s</span><span class="s">.id</span>
<span class="s">        WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">          AND </span><span class="si">%(tagged_item)s</span><span class="s">.object_id IN</span>
<span class="s">          (</span>
<span class="s">              SELECT </span><span class="si">%(tagged_item)s</span><span class="s">.object_id</span>
<span class="s">              FROM </span><span class="si">%(tagged_item)s</span><span class="s">, </span><span class="si">%(tag)s</span><span class="s"></span>
<span class="s">              WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">                AND </span><span class="si">%(tag)s</span><span class="s">.id = </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id</span>
<span class="s">                AND </span><span class="si">%(tag)s</span><span class="s">.id IN (</span><span class="si">%(tag_id_placeholders)s</span><span class="s">)</span>
<span class="s">              GROUP BY </span><span class="si">%(tagged_item)s</span><span class="s">.object_id</span>
<span class="s">              HAVING COUNT(</span><span class="si">%(tagged_item)s</span><span class="s">.object_id) = </span><span class="si">%(tag_count)s</span><span class="s"></span>
<span class="s">          )</span>
<span class="s">          AND </span><span class="si">%(tag)s</span><span class="s">.id NOT IN (</span><span class="si">%(tag_id_placeholders)s</span><span class="s">)</span>
<span class="s">        GROUP BY </span><span class="si">%(tag)s</span><span class="s">.id, </span><span class="si">%(tag)s</span><span class="s">.name</span>
<span class="s">        </span><span class="si">%(min_count_sql)s</span><span class="s"></span>
<span class="s">        ORDER BY </span><span class="si">%(tag)s</span><span class="s">.name ASC&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s">&#39;tag&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;count_sql&#39;</span><span class="p">:</span> <span class="n">counts</span> <span class="ow">and</span> <span class="s">&#39;, COUNT(</span><span class="si">%s</span><span class="s">.object_id)&#39;</span> <span class="o">%</span> <span class="n">tagged_item_table</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;tagged_item&#39;</span><span class="p">:</span> <span class="n">tagged_item_table</span><span class="p">,</span>
            <span class="s">&#39;content_type_id&#39;</span><span class="p">:</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;tag_id_placeholders&#39;</span><span class="p">:</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">tag_count</span><span class="p">),</span>
            <span class="s">&#39;tag_count&#39;</span><span class="p">:</span> <span class="n">tag_count</span><span class="p">,</span>
            <span class="s">&#39;min_count_sql&#39;</span><span class="p">:</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;HAVING COUNT(</span><span class="si">%s</span><span class="s">.object_id) &gt;= </span><span class="si">%%</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="n">tagged_item_table</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_count</span><span class="p">)</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">related</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">related</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">related</span>
</div>
<div class="viewcode-block" id="TagManager.cloud_for_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TagManager.cloud_for_model">[docs]</a>    <span class="k">def</span> <span class="nf">cloud_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="n">LOGARITHMIC</span><span class="p">,</span>
                        <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a list of tags associated with instances of the given</span>
<span class="sd">        Model, giving each tag a ``count`` attribute indicating how</span>
<span class="sd">        many times it has been used and a ``font_size`` attribute for</span>
<span class="sd">        use in displaying a tag cloud.</span>

<span class="sd">        ``steps`` defines the range of font sizes - ``font_size`` will</span>
<span class="sd">        be an integer between 1 and ``steps`` (inclusive).</span>

<span class="sd">        ``distribution`` defines the type of font size distribution</span>
<span class="sd">        algorithm which will be used - logarithmic or linear. It must</span>
<span class="sd">        be either ``tagging.utils.LOGARITHMIC`` or</span>
<span class="sd">        ``tagging.utils.LINEAR``.</span>

<span class="sd">        To limit the tags displayed in the cloud to those associated</span>
<span class="sd">        with a subset of the Model&#39;s instances, pass a dictionary of</span>
<span class="sd">        field lookups to be applied to the given Model as the</span>
<span class="sd">        ``filters`` argument.</span>

<span class="sd">        To limit the tags displayed in the cloud to those with a</span>
<span class="sd">        ``count`` greater than or equal to ``min_count``, pass a value</span>
<span class="sd">        for the ``min_count`` argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
                                         <span class="n">min_count</span><span class="o">=</span><span class="n">min_count</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">calculate_cloud</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">distribution</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="TaggedItemManager"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItemManager">[docs]</a><span class="k">class</span> <span class="nc">TaggedItemManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME There&#39;s currently no way to get the ``GROUP BY`` and ``HAVING``</span>
<span class="sd">          SQL clauses required by many of this manager&#39;s methods into</span>
<span class="sd">          Django&#39;s ORM.</span>

<span class="sd">          For now, we manually execute a query to retrieve the PKs of</span>
<span class="sd">          objects we&#39;re interested in, then use the ORM&#39;s ``__in``</span>
<span class="sd">          lookup to return a ``QuerySet``.</span>

<span class="sd">          Now that the queryset-refactor branch is in the trunk, this can be</span>
<span class="sd">          tidied up significantly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TaggedItemManager.get_by_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItemManager.get_by_model">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset_or_model</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``QuerySet`` containing instances of the specified</span>
<span class="sd">        model associated with a given tag or list of tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">get_tag_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tag_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tag_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># No existing tags were given</span>
            <span class="n">queryset</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">get_queryset_and_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">tag_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Optimisation for single tag - fall through to the simpler</span>
            <span class="c"># query below.</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intersection_by_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>

        <span class="n">queryset</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">get_queryset_and_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">)</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span>
        <span class="n">tagged_item_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
            <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">db_table</span><span class="p">],</span>
            <span class="n">where</span><span class="o">=</span><span class="p">[</span>
                <span class="s">&#39;</span><span class="si">%s</span><span class="s">.content_type_id = </span><span class="si">%%</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="n">tagged_item_table</span><span class="p">,</span>
                <span class="s">&#39;</span><span class="si">%s</span><span class="s">.tag_id = </span><span class="si">%%</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="n">tagged_item_table</span><span class="p">,</span>
                <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">.object_id&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
                                          <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">column</span><span class="p">),</span>
                                          <span class="n">tagged_item_table</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">content_type</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">pk</span><span class="p">],</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="TaggedItemManager.get_intersection_by_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItemManager.get_intersection_by_model">[docs]</a>    <span class="k">def</span> <span class="nf">get_intersection_by_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset_or_model</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``QuerySet`` containing instances of the specified</span>
<span class="sd">        model associated with *all* of the given list of tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">get_tag_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tag_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">queryset</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">get_queryset_and_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_count</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

        <span class="n">model_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="c"># This query selects the ids of all objects which have all the</span>
        <span class="c"># given tags.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT </span><span class="si">%(model_pk)s</span><span class="s"></span>
<span class="s">        FROM </span><span class="si">%(model)s</span><span class="s">, </span><span class="si">%(tagged_item)s</span><span class="s"></span>
<span class="s">        WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">          AND </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id IN (</span><span class="si">%(tag_id_placeholders)s</span><span class="s">)</span>
<span class="s">          AND </span><span class="si">%(model_pk)s</span><span class="s"> = </span><span class="si">%(tagged_item)s</span><span class="s">.object_id</span>
<span class="s">        GROUP BY </span><span class="si">%(model_pk)s</span><span class="s"></span>
<span class="s">        HAVING COUNT(</span><span class="si">%(model_pk)s</span><span class="s">) = </span><span class="si">%(tag_count)s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s">&#39;model_pk&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_table</span><span class="p">,</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">column</span><span class="p">)),</span>
            <span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">model_table</span><span class="p">,</span>
            <span class="s">&#39;tagged_item&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;content_type_id&#39;</span><span class="p">:</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;tag_id_placeholders&#39;</span><span class="p">:</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">tag_count</span><span class="p">),</span>
            <span class="s">&#39;tag_count&#39;</span><span class="p">:</span> <span class="n">tag_count</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>
        <span class="n">object_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">object_ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TaggedItemManager.get_union_by_model"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItemManager.get_union_by_model">[docs]</a>    <span class="k">def</span> <span class="nf">get_union_by_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset_or_model</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``QuerySet`` containing instances of the specified</span>
<span class="sd">        model associated with *any* of the given list of tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">get_tag_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tag_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">queryset</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">get_queryset_and_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_count</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

        <span class="n">model_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="c"># This query selects the ids of all objects which have any of</span>
        <span class="c"># the given tags.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT </span><span class="si">%(model_pk)s</span><span class="s"></span>
<span class="s">        FROM </span><span class="si">%(model)s</span><span class="s">, </span><span class="si">%(tagged_item)s</span><span class="s"></span>
<span class="s">        WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">          AND </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id IN (</span><span class="si">%(tag_id_placeholders)s</span><span class="s">)</span>
<span class="s">          AND </span><span class="si">%(model_pk)s</span><span class="s"> = </span><span class="si">%(tagged_item)s</span><span class="s">.object_id</span>
<span class="s">        GROUP BY </span><span class="si">%(model_pk)s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s">&#39;model_pk&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_table</span><span class="p">,</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">column</span><span class="p">)),</span>
            <span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">model_table</span><span class="p">,</span>
            <span class="s">&#39;tagged_item&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;content_type_id&#39;</span><span class="p">:</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;tag_id_placeholders&#39;</span><span class="p">:</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">tag_count</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>
        <span class="n">object_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">object_ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TaggedItemManager.get_related"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItemManager.get_related">[docs]</a>    <span class="k">def</span> <span class="nf">get_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">queryset_or_model</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a list of instances of the specified model which share</span>
<span class="sd">        tags with the model instance ``obj``, ordered by the number of</span>
<span class="sd">        shared tags in descending order.</span>

<span class="sd">        If ``num`` is given, a maximum of ``num`` instances will be</span>
<span class="sd">        returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">queryset</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">get_queryset_and_model</span><span class="p">(</span><span class="n">queryset_or_model</span><span class="p">)</span>
        <span class="n">model_table</span> <span class="o">=</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">)</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">related_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT </span><span class="si">%(model_pk)s</span><span class="s">, COUNT(related_tagged_item.object_id) AS </span><span class="si">%(count)s</span><span class="s"></span>
<span class="s">        FROM </span><span class="si">%(model)s</span><span class="s">, </span><span class="si">%(tagged_item)s</span><span class="s">, </span><span class="si">%(tag)s</span><span class="s">, </span><span class="si">%(tagged_item)s</span><span class="s"> related_tagged_item</span>
<span class="s">        WHERE </span><span class="si">%(tagged_item)s</span><span class="s">.object_id = </span><span class="si">%%</span><span class="s">s</span>
<span class="s">          AND </span><span class="si">%(tagged_item)s</span><span class="s">.content_type_id = </span><span class="si">%(content_type_id)s</span><span class="s"></span>
<span class="s">          AND </span><span class="si">%(tag)s</span><span class="s">.id = </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id</span>
<span class="s">          AND related_tagged_item.content_type_id = </span><span class="si">%(related_content_type_id)s</span><span class="s"></span>
<span class="s">          AND related_tagged_item.tag_id = </span><span class="si">%(tagged_item)s</span><span class="s">.tag_id</span>
<span class="s">          AND </span><span class="si">%(model_pk)s</span><span class="s"> = related_tagged_item.object_id&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">content_type</span><span class="o">.</span><span class="n">pk</span> <span class="o">==</span> <span class="n">related_content_type</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="c"># Exclude the given instance itself if determining related</span>
            <span class="c"># instances for the same model.</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">          AND related_tagged_item.object_id != </span><span class="si">%(tagged_item)s</span><span class="s">.object_id&quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        GROUP BY </span><span class="si">%(model_pk)s</span><span class="s"></span>
<span class="s">        ORDER BY </span><span class="si">%(count)s</span><span class="s"> DESC</span>
<span class="s">        </span><span class="si">%(limit_offset)s</span><span class="s">&quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s">&#39;model_pk&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_table</span><span class="p">,</span> <span class="n">qn</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">column</span><span class="p">)),</span>
            <span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">),</span>
            <span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">model_table</span><span class="p">,</span>
            <span class="s">&#39;tagged_item&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;tag&#39;</span><span class="p">:</span> <span class="n">qn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s">&#39;tag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rel</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">),</span>
            <span class="s">&#39;content_type_id&#39;</span><span class="p">:</span> <span class="n">content_type</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;related_content_type_id&#39;</span><span class="p">:</span> <span class="n">related_content_type</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="c"># Hardcoding this for now just to get tests working again - this</span>
            <span class="c"># should now be handled by the query object.</span>
            <span class="s">&#39;limit_offset&#39;</span><span class="p">:</span> <span class="n">num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="s">&#39;LIMIT </span><span class="si">%s</span><span class="s">&#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">object_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Use in_bulk here instead of an id__in lookup, because id__in would</span>
            <span class="c"># clobber the ordering.</span>
            <span class="n">object_dict</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">(</span><span class="n">object_ids</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">object_dict</span><span class="p">[</span><span class="n">object_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">object_id</span> <span class="ow">in</span> <span class="n">object_ids</span> \
                    <span class="k">if</span> <span class="n">object_id</span> <span class="ow">in</span> <span class="n">object_dict</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

<span class="c">##########</span>
<span class="c"># Models #</span>
<span class="c">##########</span>
</div></div>
<div class="viewcode-block" id="Tag"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.Tag">[docs]</a><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">TagManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,)</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;tag&#39;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</div>
<div class="viewcode-block" id="TaggedItem"><a class="viewcode-back" href="../../auto_modules.html#tagging.models.TaggedItem">[docs]</a><span class="k">class</span> <span class="nc">TaggedItem</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds the relationship between a tag and the item being tagged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span>          <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;tag&#39;</span><span class="p">),</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;items&#39;</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;content type&#39;</span><span class="p">))</span>
    <span class="n">object_id</span>    <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;object id&#39;</span><span class="p">),</span> <span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">object</span>       <span class="o">=</span> <span class="n">generic</span><span class="o">.</span><span class="n">GenericForeignKey</span><span class="p">(</span><span class="s">&#39;content_type&#39;</span><span class="p">,</span> <span class="s">&#39;object_id&#39;</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">TaggedItemManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># Enforce unique tag association per object</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;tag&#39;</span><span class="p">,</span> <span class="s">&#39;content_type&#39;</span><span class="p">,</span> <span class="s">&#39;object_id&#39;</span><span class="p">),)</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;tagged item&#39;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;tagged items&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, jonas ohrstrom.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>