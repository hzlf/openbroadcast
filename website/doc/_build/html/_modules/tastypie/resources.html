<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tastypie.resources &mdash; obp 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="obp 0.0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for tastypie.resources</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span><span class="p">,</span> <span class="n">MultipleObjectsReturned</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">NoReverseMatch</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">resolve</span><span class="p">,</span> <span class="n">Resolver404</span><span class="p">,</span> <span class="n">get_script_prefix</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">transaction</span>
<span class="kn">from</span> <span class="nn">django.db.models.sql.constants</span> <span class="kn">import</span> <span class="n">QUERY_TERMS</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseNotFound</span><span class="p">,</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">django.utils.cache</span> <span class="kn">import</span> <span class="n">patch_cache_control</span><span class="p">,</span> <span class="n">patch_vary_headers</span>
<span class="kn">from</span> <span class="nn">tastypie.authentication</span> <span class="kn">import</span> <span class="n">Authentication</span>
<span class="kn">from</span> <span class="nn">tastypie.authorization</span> <span class="kn">import</span> <span class="n">ReadOnlyAuthorization</span>
<span class="kn">from</span> <span class="nn">tastypie.bundle</span> <span class="kn">import</span> <span class="n">Bundle</span>
<span class="kn">from</span> <span class="nn">tastypie.cache</span> <span class="kn">import</span> <span class="n">NoCache</span>
<span class="kn">from</span> <span class="nn">tastypie.constants</span> <span class="kn">import</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">ALL_WITH_RELATIONS</span>
<span class="kn">from</span> <span class="nn">tastypie.exceptions</span> <span class="kn">import</span> <span class="n">NotFound</span><span class="p">,</span> <span class="n">BadRequest</span><span class="p">,</span> <span class="n">InvalidFilterError</span><span class="p">,</span> <span class="n">HydrationError</span><span class="p">,</span> <span class="n">InvalidSortError</span><span class="p">,</span> <span class="n">ImmediateHttpResponse</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">http</span>
<span class="kn">from</span> <span class="nn">tastypie.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">tastypie.serializers</span> <span class="kn">import</span> <span class="n">Serializer</span>
<span class="kn">from</span> <span class="nn">tastypie.throttle</span> <span class="kn">import</span> <span class="n">BaseThrottle</span>
<span class="kn">from</span> <span class="nn">tastypie.utils</span> <span class="kn">import</span> <span class="n">is_valid_jsonp_callback_value</span><span class="p">,</span> <span class="n">dict_strip_unicode_keys</span><span class="p">,</span> <span class="n">trailing_slash</span>
<span class="kn">from</span> <span class="nn">tastypie.utils.mime</span> <span class="kn">import</span> <span class="n">determine_format</span><span class="p">,</span> <span class="n">build_content_type</span>
<span class="kn">from</span> <span class="nn">tastypie.validation</span> <span class="kn">import</span> <span class="n">Validation</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">set</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span>
<span class="c"># The ``copy`` module became function-friendly in Python 2.5 and</span>
<span class="c"># ``copycompat`` was added in post 1.1.1 Django (r11901)..</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.utils.copycompat</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="c"># If ``csrf_exempt`` isn&#39;t present, stub it.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">csrf_exempt</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span>

<span class="c"># Django 1.5 has moved this constant up one level.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.db.models.constants</span> <span class="kn">import</span> <span class="n">LOOKUP_SEP</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.db.models.sql.constants</span> <span class="kn">import</span> <span class="n">LOOKUP_SEP</span>


<div class="viewcode-block" id="NOT_AVAILABLE"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.NOT_AVAILABLE">[docs]</a><span class="k">class</span> <span class="nc">NOT_AVAILABLE</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;No such data is available.&#39;</span>

</div>
<div class="viewcode-block" id="ResourceOptions"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ResourceOptions">[docs]</a><span class="k">class</span> <span class="nc">ResourceOptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration class for ``Resource``.</span>

<span class="sd">    Provides sane defaults and the logic needed to augment these settings with</span>
<span class="sd">    the internal ``class Meta`` used on ``Resource`` subclasses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">()</span>
    <span class="n">authentication</span> <span class="o">=</span> <span class="n">Authentication</span><span class="p">()</span>
    <span class="n">authorization</span> <span class="o">=</span> <span class="n">ReadOnlyAuthorization</span><span class="p">()</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">NoCache</span><span class="p">()</span>
    <span class="n">throttle</span> <span class="o">=</span> <span class="n">BaseThrottle</span><span class="p">()</span>
    <span class="n">validation</span> <span class="o">=</span> <span class="n">Validation</span><span class="p">()</span>
    <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">Paginator</span>
    <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="s">&#39;put&#39;</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="s">&#39;patch&#39;</span><span class="p">]</span>
    <span class="n">list_allowed_methods</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">detail_allowed_methods</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;API_LIMIT_PER_PAGE&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">max_limit</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">api_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">resource_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">urlconf_namespace</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">default_format</span> <span class="o">=</span> <span class="s">&#39;application/json&#39;</span>
    <span class="n">filtering</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">object_class</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">include_resource_uri</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">include_absolute_url</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">always_return_data</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&#39;objects&#39;</span>
    <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;pk&#39;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Handle overrides.</span>
        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">override_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">meta</span><span class="p">):</span>
                <span class="c"># No internals please.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">override_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                    <span class="n">overrides</span><span class="p">[</span><span class="n">override_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">override_name</span><span class="p">)</span>

        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;allowed_methods&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="s">&#39;put&#39;</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="s">&#39;patch&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;list_allowed_methods&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">overrides</span><span class="p">[</span><span class="s">&#39;list_allowed_methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allowed_methods</span>

        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;detail_allowed_methods&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">overrides</span><span class="p">[</span><span class="s">&#39;detail_allowed_methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allowed_methods</span>

        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;ResourceOptions&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">cls</span><span class="p">,),</span> <span class="n">overrides</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="DeclarativeMetaclass"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.DeclarativeMetaclass">[docs]</a><span class="k">class</span> <span class="nc">DeclarativeMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;base_fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">declared_fields</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Inherit any fields from parent(s).</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span> <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">Resource</span><span class="p">)]</span>
            <span class="c"># Simulate the MRO.</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="n">parent_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;base_fields&#39;</span><span class="p">,</span> <span class="p">{})</span>

                <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="n">parent_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;base_fields&#39;</span><span class="p">][</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_object</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c"># Look for ``dehydrated_type`` instead of doing ``isinstance``,</span>
            <span class="c"># which can break down if Tastypie is re-namespaced as something</span>
            <span class="c"># else.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;dehydrated_type&#39;</span><span class="p">):</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="n">declared_fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>

        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;base_fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">declared_fields</span><span class="p">)</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;declared_fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">declared_fields</span>
        <span class="n">new_class</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DeclarativeMetaclass</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="p">,</span> <span class="s">&#39;Meta&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">ResourceOptions</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;resource_name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># No ``resource_name`` provided. Attempt to auto-name the resource.</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">new_class</span><span class="o">.</span><span class="n">__name__</span>
            <span class="n">name_bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">bit</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">class_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;Resource&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">bit</span><span class="p">]</span>
            <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_bits</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span> <span class="o">=</span> <span class="n">resource_name</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;include_resource_uri&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;resource_uri&#39;</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">:</span>
                <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="s">&#39;resource_uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;resource_uri&#39;</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;resource_uri&#39;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">del</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="s">&#39;resource_uri&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;contribute_to_class&#39;</span><span class="p">):</span>
                <span class="n">field_object</span><span class="o">.</span><span class="n">contribute_to_class</span><span class="p">(</span><span class="n">new_class</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_class</span>

</div>
<div class="viewcode-block" id="Resource"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource">[docs]</a><span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the data, request dispatch and responding to requests.</span>

<span class="sd">    Serialization/deserialization is handled &quot;at the edges&quot; (i.e. at the</span>
<span class="sd">    beginning/end of the request/response cycle) so that everything internally</span>
<span class="sd">    is Python data structures.</span>

<span class="sd">    This class tries to be non-model specific, so it can be hooked up to other</span>
<span class="sd">    data sources, such as search results, files, other data, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">DeclarativeMetaclass</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">api_name</span> <span class="o">=</span> <span class="n">api_name</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Resource.wrap_view"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.wrap_view">[docs]</a>    <span class="k">def</span> <span class="nf">wrap_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wraps methods so they can be called in a more functional way as well</span>
<span class="sd">        as handling exceptions better.</span>

<span class="sd">        Note that if ``BadRequest`` or an exception with a ``response`` attr</span>
<span class="sd">        are seen, there is special handling to either present a message back</span>
<span class="sd">        to the user or return the response traveling with the exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@csrf_exempt</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">callback</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="c"># Our response can vary based on a number of factors, use</span>
                <span class="c"># the cache class to determine what we should ``Vary`` on so</span>
                <span class="c"># caches won&#39;t return the wrong (cached) version.</span>
                <span class="n">varies</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span> <span class="s">&quot;varies&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">if</span> <span class="n">varies</span><span class="p">:</span>
                    <span class="n">patch_vary_headers</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">varies</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cacheable</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cache_control</span><span class="p">():</span>
                        <span class="c"># If the request is cacheable and we have a</span>
                        <span class="c"># ``Cache-Control`` available then patch the header.</span>
                        <span class="n">patch_cache_control</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cache_control</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cache-Control&quot;</span><span class="p">):</span>
                    <span class="c"># IE excessively caches XMLHttpRequests, so we&#39;re disabling</span>
                    <span class="c"># the browser cache here.</span>
                    <span class="c"># See http://www.enhanceie.com/ie/bugs.asp for details.</span>
                    <span class="n">patch_cache_control</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">no_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">response</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">BadRequest</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">ApiFieldError</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpBadRequest</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpBadRequest</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">messages</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s">&#39;response&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>

                <span class="c"># A real, non-expected exception.</span>
                <span class="c"># Handle the case where the full traceback is more helpful</span>
                <span class="c"># than the serialized error.</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;TASTYPIE_FULL_DEBUG&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                    <span class="k">raise</span>

                <span class="c"># Re-raise the error to get a proper traceback when the error</span>
                <span class="c"># happend during a test case</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SERVER_NAME&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;testserver&#39;</span><span class="p">:</span>
                    <span class="k">raise</span>

                <span class="c"># Rather than re-raising, we&#39;re going to things similar to</span>
                <span class="c"># what Django does. The difference is returning a serialized</span>
                <span class="c"># error message.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_500</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</div>
    <span class="k">def</span> <span class="nf">_handle_500</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">traceback</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">the_trace</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())))</span>
        <span class="n">response_class</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpApplicationError</span>
        <span class="n">response_code</span> <span class="o">=</span> <span class="mi">500</span>

        <span class="n">NOT_FOUND_EXCEPTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="n">NotFound</span><span class="p">,</span> <span class="n">ObjectDoesNotExist</span><span class="p">,</span> <span class="n">Http404</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">NOT_FOUND_EXCEPTIONS</span><span class="p">):</span>
            <span class="n">response_class</span> <span class="o">=</span> <span class="n">HttpResponseNotFound</span>
            <span class="n">response_code</span> <span class="o">=</span> <span class="mi">404</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;error_message&quot;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">exception</span><span class="p">),</span>
                <span class="s">&quot;traceback&quot;</span><span class="p">:</span> <span class="n">the_trace</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">desired_format</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response_class</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">build_content_type</span><span class="p">(</span><span class="n">desired_format</span><span class="p">))</span>

        <span class="c"># When DEBUG is False, send an error message to the admins (unless it&#39;s</span>
        <span class="c"># a 404, in which case we check the setting).</span>
        <span class="n">send_broken_links</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;SEND_BROKEN_LINK_EMAILS&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response_code</span> <span class="o">==</span> <span class="mi">404</span> <span class="ow">or</span> <span class="n">send_broken_links</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;django.request.tastypie&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Internal Server Error: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response_code</span><span class="p">,</span> <span class="s">&#39;request&#39;</span><span class="p">:</span><span class="n">request</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">django</span><span class="o">.</span><span class="n">VERSION</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">mail_admins</span>
                <span class="n">subject</span> <span class="o">=</span> <span class="s">&#39;Error (</span><span class="si">%s</span><span class="s"> IP): </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;REMOTE_ADDR&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">INTERNAL_IPS</span> <span class="ow">and</span> <span class="s">&#39;internal&#39;</span> <span class="ow">or</span> <span class="s">&#39;EXTERNAL&#39;</span><span class="p">),</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">request_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">request_repr</span> <span class="o">=</span> <span class="s">&quot;Request repr() unavailable&quot;</span>

                <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">the_trace</span><span class="p">,</span> <span class="n">request_repr</span><span class="p">)</span>
                <span class="n">mail_admins</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">fail_silently</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Prep the data going out.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;error_message&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;TASTYPIE_CANNED_ERROR&#39;</span><span class="p">,</span> <span class="s">&quot;Sorry, this request could not be processed. Please try again later.&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">desired_format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response_class</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">build_content_type</span><span class="p">(</span><span class="n">desired_format</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_build_reverse_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience hook for overriding how URLs are built.</span>

<span class="sd">        See ``NamespacedModelResource._build_reverse_url`` for an example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Resource.base_urls"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.base_urls">[docs]</a>    <span class="k">def</span> <span class="nf">base_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The standard URLs this ``Resource`` should respond to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_list&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_list&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/schema</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_schema&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_schema&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/set/(?P&lt;</span><span class="si">%s</span><span class="s">_list&gt;\w[\w/;-]*)</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_multiple&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_multiple&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;</span><span class="si">%s</span><span class="s">&gt;\w[\w/-]*)</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>
</div>
<div class="viewcode-block" id="Resource.override_urls"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.override_urls">[docs]</a>    <span class="k">def</span> <span class="nf">override_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated. Will be removed by v1.0.0. Please use ``prepend_urls`` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Resource.prepend_urls"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.prepend_urls">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook for adding your own URLs or matching before the default URLs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Resource.urls"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.urls">[docs]</a>    <span class="k">def</span> <span class="nf">urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The endpoints this ``Resource`` responds to.</span>

<span class="sd">        Mostly a standard URLconf, this is suitable for either automatic use</span>
<span class="sd">        when registered with an ``Api`` class or for including directly in</span>
<span class="sd">        a URLconf should you choose to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepend_urls</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">override_urls</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;&#39;override_urls&#39; is a deprecated method &amp; will be removed by v1.0.0. Please rename your method to ``prepend_urls``.&quot;</span><span class="p">)</span>
            <span class="n">urls</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">override_urls</span><span class="p">()</span>

        <span class="n">urls</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">()</span>
        <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">urls</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">urlpatterns</span>
</div>
<div class="viewcode-block" id="Resource.determine_format"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.determine_format">[docs]</a>    <span class="k">def</span> <span class="nf">determine_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to determine the desired format.</span>

<span class="sd">        Largely relies on ``tastypie.utils.mime.determine_format`` but here</span>
<span class="sd">        as a point of extension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">serializer</span><span class="p">,</span> <span class="n">default_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">default_format</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.serialize"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a request, data and a desired format, produces a serialized</span>
<span class="sd">        version suitable for transfer over the wire.</span>

<span class="sd">        Mostly a hook, this uses the ``Serializer`` from ``Resource._meta``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s">&#39;text/javascript&#39;</span> <span class="ow">in</span> <span class="n">format</span><span class="p">:</span>
            <span class="c"># get JSONP callback name. default to &quot;callback&quot;</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;callback&#39;</span><span class="p">,</span> <span class="s">&#39;callback&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_jsonp_callback_value</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;JSONP callback name is invalid.&#39;</span><span class="p">)</span>

            <span class="n">options</span><span class="p">[</span><span class="s">&#39;callback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.deserialize"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.deserialize">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a request, data and a format, deserializes the given data.</span>

<span class="sd">        It relies on the request properly sending a ``CONTENT_TYPE`` header,</span>
<span class="sd">        falling back to ``application/json`` if not provided.</span>

<span class="sd">        Mostly a hook, this uses the ``Serializer`` from ``Resource._meta``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">format</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">)</span>


        <span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span>
        
        <span class="k">print</span> <span class="s">&#39;format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">format</span>
        

        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">:</span>
            <span class="n">deserialized</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>
        <span class="k">elif</span> <span class="n">format</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">):</span>
            <span class="n">deserialized</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">deserialized</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">deserialized</span>
</div>
<div class="viewcode-block" id="Resource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to alter list data just before it gets serialized &amp; sent to the user.</span>

<span class="sd">        Useful for restructuring/renaming aspects of the what&#39;s going to be</span>
<span class="sd">        sent.</span>

<span class="sd">        Should accommodate for a list of objects, generally also including</span>
<span class="sd">        meta data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Resource.alter_detail_data_to_serialize"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.alter_detail_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_detail_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to alter detail data just before it gets serialized &amp; sent to the user.</span>

<span class="sd">        Useful for restructuring/renaming aspects of the what&#39;s going to be</span>
<span class="sd">        sent.</span>

<span class="sd">        Should accommodate for receiving a single bundle of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Resource.alter_deserialized_list_data"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.alter_deserialized_list_data">[docs]</a>    <span class="k">def</span> <span class="nf">alter_deserialized_list_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to alter list data just after it has been received from the user &amp;</span>
<span class="sd">        gets deserialized.</span>

<span class="sd">        Useful for altering the user data before any hydration is applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Resource.alter_deserialized_detail_data"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.alter_deserialized_detail_data">[docs]</a>    <span class="k">def</span> <span class="nf">alter_deserialized_detail_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to alter detail data just after it has been received from the user &amp;</span>
<span class="sd">        gets deserialized.</span>

<span class="sd">        Useful for altering the user data before any hydration is applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Resource.dispatch_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.dispatch_list">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A view for handling the various HTTP methods (GET/POST/PUT/DELETE) over</span>
<span class="sd">        the entire list of resources.</span>

<span class="sd">        Relies on ``Resource.dispatch`` for the heavy-lifting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.dispatch_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.dispatch_detail">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A view for handling the various HTTP methods (GET/POST/PUT/DELETE) on</span>
<span class="sd">        a single resource.</span>

<span class="sd">        Relies on ``Resource.dispatch`` for the heavy-lifting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;detail&#39;</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.dispatch"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.dispatch">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the common operations (allowed HTTP method, authentication,</span>
<span class="sd">        throttling, method lookup) surrounding most CRUD interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_allowed_methods&quot;</span> <span class="o">%</span> <span class="n">request_type</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;HTTP_X_HTTP_METHOD_OVERRIDE&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s">&#39;HTTP_X_HTTP_METHOD_OVERRIDE&#39;</span><span class="p">]</span>

        <span class="n">request_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_check</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="n">allowed_methods</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request_method</span><span class="p">,</span> <span class="n">request_type</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpNotImplemented</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_authorized</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_check</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># All clear. Process the request.</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">convert_post_to_put</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># Add the throttled request.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_throttled_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># If what comes back isn&#39;t a ``HttpResponse``, assume that the</span>
        <span class="c"># request was accepted and that some action occurred. This also</span>
        <span class="c"># prevents Django from freaking out.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNoContent</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="Resource.remove_api_resource_names"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.remove_api_resource_names">[docs]</a>    <span class="k">def</span> <span class="nf">remove_api_resource_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a dictionary of regex matches from a URLconf, removes</span>
<span class="sd">        ``api_name`` and/or ``resource_name`` if found.</span>

<span class="sd">        This is useful for converting URLconf matches into something suitable</span>
<span class="sd">        for data lookup. For example::</span>

<span class="sd">            Model.objects.filter(**self.remove_api_resource_names(matches))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs_subset</span> <span class="o">=</span> <span class="n">url_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;api_name&#39;</span><span class="p">,</span> <span class="s">&#39;resource_name&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">kwargs_subset</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">kwargs_subset</span>
</div>
<div class="viewcode-block" id="Resource.method_check"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.method_check">[docs]</a>    <span class="k">def</span> <span class="nf">method_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures that the HTTP method used on the request is allowed to be</span>
<span class="sd">        handled by the resource.</span>

<span class="sd">        Takes an ``allowed`` parameter, which should be a list of lowercase</span>
<span class="sd">        HTTP methods to check against. Usually, this looks like::</span>

<span class="sd">            # The most generic lookup.</span>
<span class="sd">            self.method_check(request, self._meta.allowed_methods)</span>

<span class="sd">            # A lookup against what&#39;s allowed for list-type methods.</span>
<span class="sd">            self.method_check(request, self._meta.list_allowed_methods)</span>

<span class="sd">            # A useful check when creating a new endpoint that only handles</span>
<span class="sd">            # GET.</span>
<span class="sd">            self.method_check(request, [&#39;get&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allowed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allowed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">request_method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">allows</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">allowed</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">request_method</span> <span class="o">==</span> <span class="s">&quot;options&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">allows</span><span class="p">)</span>
            <span class="n">response</span><span class="p">[</span><span class="s">&#39;Allow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allows</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request_method</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpMethodNotAllowed</span><span class="p">(</span><span class="n">allows</span><span class="p">)</span>
            <span class="n">response</span><span class="p">[</span><span class="s">&#39;Allow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allows</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">request_method</span>
</div>
<div class="viewcode-block" id="Resource.is_authorized"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.is_authorized">[docs]</a>    <span class="k">def</span> <span class="nf">is_authorized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles checking of permissions to see if the user has authorization</span>
<span class="sd">        to GET, POST, PUT, or DELETE this resource.  If ``object`` is provided,</span>
<span class="sd">        the authorization backend can apply additional row-level permissions</span>
<span class="sd">        checking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">auth_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">is_authorized</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_result</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">auth_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_result</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpUnauthorized</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Resource.is_authenticated"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.is_authenticated">[docs]</a>    <span class="k">def</span> <span class="nf">is_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles checking if the user is authenticated and dealing with</span>
<span class="sd">        unauthenticated users.</span>

<span class="sd">        Mostly a hook, this uses class assigned to ``authentication`` from</span>
<span class="sd">        ``Resource._meta``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Authenticate the request as needed.</span>
        <span class="n">auth_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_result</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">auth_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_result</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpUnauthorized</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Resource.throttle_check"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.throttle_check">[docs]</a>    <span class="k">def</span> <span class="nf">throttle_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles checking if the user should be throttled.</span>

<span class="sd">        Mostly a hook, this uses class assigned to ``throttle`` from</span>
<span class="sd">        ``Resource._meta``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">get_identifier</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># Check to see if they should be throttled.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">throttle</span><span class="o">.</span><span class="n">should_be_throttled</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
            <span class="c"># Throttle limit exceeded.</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpTooManyRequests</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Resource.log_throttled_access"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.log_throttled_access">[docs]</a>    <span class="k">def</span> <span class="nf">log_throttled_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the recording of the user&#39;s access for throttling purposes.</span>

<span class="sd">        Mostly a hook, this uses class assigned to ``throttle`` from</span>
<span class="sd">        ``Resource._meta``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">throttle</span><span class="o">.</span><span class="n">accessed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">get_identifier</span><span class="p">(</span><span class="n">request</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">(),</span> <span class="n">request_method</span><span class="o">=</span><span class="n">request_method</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.build_bundle"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.build_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">build_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given either an object, a data dictionary or both, builds a ``Bundle``</span>
<span class="sd">        for use throughout the ``dehydrate/hydrate`` cycle.</span>

<span class="sd">        If no object is provided, an empty object from</span>
<span class="sd">        ``Resource._meta.object_class`` is created so that attempts to access</span>
<span class="sd">        ``bundle.obj`` do not fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.build_filters"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.build_filters">[docs]</a>    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows for the filtering of applicable objects.</span>

<span class="sd">        This needs to be implemented at the user level.&#39;</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">filters</span>
</div>
<div class="viewcode-block" id="Resource.apply_sorting"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.apply_sorting">[docs]</a>    <span class="k">def</span> <span class="nf">apply_sorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_list</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows for the sorting of objects being returned.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj_list</span>
</div>
<div class="viewcode-block" id="Resource.get_bundle_detail_data"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_bundle_detail_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_bundle_detail_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method to return the ``detail_uri_name`` attribute off</span>
<span class="sd">        ``bundle.obj``.</span>

<span class="sd">        Usually just accesses ``bundle.obj.pk`` by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">)</span>

    <span class="c"># URL-related methods.</span>
</div>
<div class="viewcode-block" id="Resource.detail_uri_kwargs"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.detail_uri_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">detail_uri_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        Given a ``Bundle`` or an object, it returns the extra kwargs needed to</span>
<span class="sd">        generate a detail URI.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.resource_uri_kwargs"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.resource_uri_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">resource_uri_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a dictionary of kwargs to help generate URIs.</span>

<span class="sd">        Automatically provides the ``Resource.Meta.resource_name`` (and</span>
<span class="sd">        optionally the ``Resource.Meta.api_name`` if populated by an ``Api``</span>
<span class="sd">        object).</span>

<span class="sd">        If the ``bundle_or_obj`` argument is provided, it calls</span>
<span class="sd">        ``Resource.detail_uri_kwargs`` for additional bits to create</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;resource_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">api_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;api_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">api_name</span>

        <span class="k">if</span> <span class="n">bundle_or_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_uri_kwargs</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">kwargs</span>
</div>
<div class="viewcode-block" id="Resource.get_resource_uri"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url_name</span><span class="o">=</span><span class="s">&#39;api_dispatch_list&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles generating a resource URI.</span>

<span class="sd">        If the ``bundle_or_obj`` argument is not provided, it builds the URI</span>
<span class="sd">        for the list endpoint.</span>

<span class="sd">        If the ``bundle_or_obj`` argument is provided, it builds the URI for</span>
<span class="sd">        the detail endpoint.</span>

<span class="sd">        Return the generated URI. If that URI can not be reversed (not found</span>
<span class="sd">        in the URLconf), it will return an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bundle_or_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">url_name</span> <span class="o">=</span> <span class="s">&#39;api_dispatch_detail&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_reverse_url</span><span class="p">(</span><span class="n">url_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_uri_kwargs</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">NoReverseMatch</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Resource.get_via_uri"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_via_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_via_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This pulls apart the salient bits of the URI and populates the</span>
<span class="sd">        resource via a ``obj_get``.</span>

<span class="sd">        Optionally accepts a ``request``.</span>

<span class="sd">        If you need custom behavior based on other portions of the URI,</span>
<span class="sd">        simply override this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">get_script_prefix</span><span class="p">()</span>
        <span class="n">chomped_uri</span> <span class="o">=</span> <span class="n">uri</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">chomped_uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">chomped_uri</span> <span class="o">=</span> <span class="n">chomped_uri</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">view</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">chomped_uri</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Resolver404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="s">&quot;The URL provided &#39;</span><span class="si">%s</span><span class="s">&#39; was not a link to a valid resource.&quot;</span> <span class="o">%</span> <span class="n">uri</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="c"># Data preparation.</span>
</div>
<div class="viewcode-block" id="Resource.full_dehydrate"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.full_dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">full_dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a bundle with an object instance, extract the information from it</span>
<span class="sd">        to populate the resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Dehydrate each field.</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c"># A touch leaky but it makes URI resolution work.</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;dehydrated_type&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;related&#39;</span><span class="p">:</span>
                <span class="n">field_object</span><span class="o">.</span><span class="n">api_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">api_name</span>
                <span class="n">field_object</span><span class="o">.</span><span class="n">resource_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span>

            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_object</span><span class="o">.</span><span class="n">dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="c"># Check for an optional method to do further dehydration.</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;dehydrate_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.dehydrate"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to allow a final manipulation of data once all fields/methods</span>
<span class="sd">        have built out the dehydrated data.</span>

<span class="sd">        Useful if you need to access more than one dehydrated field or want</span>
<span class="sd">        to annotate on additional data.</span>

<span class="sd">        Must return the modified bundle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.full_hydrate"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.full_hydrate">[docs]</a>    <span class="k">def</span> <span class="nf">full_hydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a populated bundle, distill it and turn it back into</span>
<span class="sd">        a full-fledged object instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">()</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">readonly</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># Check for an optional method to do further hydration.</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;hydrate_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">bundle</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">field_object</span><span class="o">.</span><span class="n">hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

                <span class="c"># NOTE: We only get back a bundle when it is related field.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">):</span>
                    <span class="n">bundle</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">field_object</span><span class="o">.</span><span class="n">null</span><span class="p">:</span>
                    <span class="c"># We need to avoid populating M2M data here as that will</span>
                    <span class="c"># cause things to blow up.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_related&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">field_object</span><span class="o">.</span><span class="n">blank</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">elif</span> <span class="n">field_object</span><span class="o">.</span><span class="n">null</span><span class="p">:</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.hydrate"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.hydrate">[docs]</a>    <span class="k">def</span> <span class="nf">hydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to allow an initial manipulation of data before all methods/fields</span>
<span class="sd">        have built out the hydrated data.</span>

<span class="sd">        Useful if you need to access more than one hydrated field or want</span>
<span class="sd">        to annotate on additional data.</span>

<span class="sd">        Must return the modified bundle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.hydrate_m2m"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.hydrate_m2m">[docs]</a>    <span class="k">def</span> <span class="nf">hydrate_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate the ManyToMany data on the instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HydrationError</span><span class="p">(</span><span class="s">&quot;You must call &#39;full_hydrate&#39; before attempting to run &#39;hydrate_m2m&#39; on </span><span class="si">%r</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
                <span class="c"># Note that we only hydrate the data, leaving the instance</span>
                <span class="c"># unmodified. It&#39;s up to the user&#39;s code to handle this.</span>
                <span class="c"># The ``ModelResource`` provides a working baseline</span>
                <span class="c"># in this regard.</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_object</span><span class="o">.</span><span class="n">hydrate_m2m</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;hydrate_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.build_schema"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.build_schema">[docs]</a>    <span class="k">def</span> <span class="nf">build_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary of all the fields on the resource and some</span>
<span class="sd">        properties about those fields.</span>

<span class="sd">        Used by the ``schema/`` endpoint to describe what will be available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">&#39;default_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">default_format</span><span class="p">,</span>
            <span class="s">&#39;allowed_list_http_methods&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">list_allowed_methods</span><span class="p">,</span>
            <span class="s">&#39;allowed_detail_http_methods&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">,</span>
            <span class="s">&#39;default_limit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ordering</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;ordering&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ordering</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;filtering&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">][</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">dehydrated_type</span><span class="p">,</span>
                <span class="s">&#39;nullable&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">null</span><span class="p">,</span>
                <span class="s">&#39;blank&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">blank</span><span class="p">,</span>
                <span class="s">&#39;readonly&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">readonly</span><span class="p">,</span>
                <span class="s">&#39;help_text&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">help_text</span><span class="p">,</span>
                <span class="s">&#39;unique&#39;</span><span class="p">:</span> <span class="n">field_object</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">dehydrated_type</span> <span class="o">==</span> <span class="s">&#39;related&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                    <span class="n">related_type</span> <span class="o">=</span> <span class="s">&#39;to_many&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">related_type</span> <span class="o">=</span> <span class="s">&#39;to_one&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">][</span><span class="n">field_name</span><span class="p">][</span><span class="s">&#39;related_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">related_type</span>

        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Resource.dehydrate_resource_uri"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.dehydrate_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the automatically included ``resource_uri`` field, dehydrate</span>
<span class="sd">        the URI for the given bundle.</span>

<span class="sd">        Returns empty string if no URI can be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="k">except</span> <span class="n">NoReverseMatch</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Resource.generate_cache_key"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.generate_cache_key">[docs]</a>    <span class="k">def</span> <span class="nf">generate_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a unique-enough cache key.</span>

<span class="sd">        This is based off the current api_name/resource_name/args/kwargs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">smooshed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">smooshed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="c"># Use a list plus a ``.join()`` because it&#39;s faster than concatenation.</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">api_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">smooshed</span><span class="p">))</span>

    <span class="c"># Data access methods.</span>
</div>
<div class="viewcode-block" id="Resource.get_object_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to allow making returning the list of available objects.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.apply_authorization_limits"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.apply_authorization_limits">[docs]</a>    <span class="k">def</span> <span class="nf">apply_authorization_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows the ``Authorization`` class to further limit the object list.</span>
<span class="sd">        Also a hook to customize per ``Resource``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authorization</span><span class="p">,</span> <span class="s">&#39;apply_limits&#39;</span><span class="p">):</span>
            <span class="n">object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">apply_limits</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">object_list</span>
</div>
<div class="viewcode-block" id="Resource.can_create"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.can_create">[docs]</a>    <span class="k">def</span> <span class="nf">can_create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to ensure ``post`` is within ``allowed_methods``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">list_allowed_methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;post&#39;</span> <span class="ow">in</span> <span class="n">allowed</span>
</div>
<div class="viewcode-block" id="Resource.can_update"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.can_update">[docs]</a>    <span class="k">def</span> <span class="nf">can_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to ensure ``put`` is within ``allowed_methods``.</span>

<span class="sd">        Used when hydrating related data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">list_allowed_methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;put&#39;</span> <span class="ow">in</span> <span class="n">allowed</span>
</div>
<div class="viewcode-block" id="Resource.can_delete"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.can_delete">[docs]</a>    <span class="k">def</span> <span class="nf">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to ensure ``delete`` is within ``allowed_methods``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">list_allowed_methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;delete&#39;</span> <span class="ow">in</span> <span class="n">allowed</span>
</div>
<div class="viewcode-block" id="Resource.apply_filters"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.apply_filters">[docs]</a>    <span class="k">def</span> <span class="nf">apply_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">applicable_filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A hook to alter how the filters are applied to the object list.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.obj_get_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the list of objects available on the resource.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.cached_obj_get_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.cached_obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">cached_obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A version of ``obj_get_list`` that uses the cache as a means to get</span>
<span class="sd">        commonly-accessed data faster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">obj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">obj_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj_list</span>
</div>
<div class="viewcode-block" id="Resource.obj_get"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches an individual object on the resource.</span>

<span class="sd">        This needs to be implemented at the user level. If the object can not</span>
<span class="sd">        be found, this should raise a ``NotFound`` exception.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.cached_obj_get"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.cached_obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">cached_obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A version of ``obj_get`` that uses the cache as a means to get</span>
<span class="sd">        commonly-accessed data faster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span><span class="s">&#39;detail&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bundle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="Resource.obj_create"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_create">[docs]</a>    <span class="k">def</span> <span class="nf">obj_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new object based on the provided data.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.obj_update"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_update">[docs]</a>    <span class="k">def</span> <span class="nf">obj_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates an existing object (or creates a new object) based on the</span>
<span class="sd">        provided data.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.obj_delete_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_delete_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_delete_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes an entire list of objects.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.obj_delete"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.obj_delete">[docs]</a>    <span class="k">def</span> <span class="nf">obj_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a single object.</span>

<span class="sd">        This needs to be implemented at the user level.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.create_response"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.create_response">[docs]</a>    <span class="k">def</span> <span class="nf">create_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">HttpResponse</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the common &quot;which-format/serialize/return-response&quot; cycle.</span>

<span class="sd">        Mostly a useful shortcut/hook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">desired_format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response_class</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">build_content_type</span><span class="p">(</span><span class="n">desired_format</span><span class="p">),</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.error_response"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.error_response">[docs]</a>    <span class="k">def</span> <span class="nf">error_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">:</span>
            <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">default_format</span>

        <span class="n">serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">desired_format</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpBadRequest</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">build_content_type</span><span class="p">(</span><span class="n">desired_format</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.is_valid"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles checking if the data provided by the user is valid.</span>

<span class="sd">        Mostly a hook, this uses class assigned to ``validation`` from</span>
<span class="sd">        ``Resource._meta``.</span>

<span class="sd">        If validation fails, an error is raised with the error messages</span>
<span class="sd">        serialized inside it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">bundle</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Resource.rollback"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.rollback">[docs]</a>    <span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the list of bundles, delete all objects pertaining to those</span>
<span class="sd">        bundles.</span>

<span class="sd">        This needs to be implemented at the user level. No exceptions should</span>
<span class="sd">        be raised if possible.</span>

<span class="sd">        ``ModelResource`` includes a full working version specific to Django&#39;s</span>
<span class="sd">        ``Models``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="c"># Views.</span>
</div>
<div class="viewcode-block" id="Resource.get_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a serialized list of resources.</span>

<span class="sd">        Calls ``obj_get_list`` to provide the data, then handles that result</span>
<span class="sd">        set and serializes it.</span>

<span class="sd">        Should return a HttpResponse (200 OK).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Uncached for now. Invalidation that works for everyone may be</span>
        <span class="c">#       impossible.</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">sorted_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_sorting</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="n">paginator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">paginator_class</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">sorted_objects</span><span class="p">,</span> <span class="n">resource_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(),</span> <span class="n">limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="n">max_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">max_limit</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">()</span>

        <span class="c"># Dehydrate the bundles in preparation for serialization.</span>
        <span class="n">bundles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">to_be_serialized</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]]</span>
        <span class="n">to_be_serialized</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span> <span class="k">for</span> <span class="n">bundle</span> <span class="ow">in</span> <span class="n">bundles</span><span class="p">]</span>
        <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_list_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.get_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_detail">[docs]</a>    <span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a single serialized resource.</span>

<span class="sd">        Calls ``cached_obj_get/obj_get`` to provide the data, then handles that result</span>
<span class="sd">        set and serializes it.</span>

<span class="sd">        Should return a HttpResponse (200 OK).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_obj_get</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNotFound</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpMultipleChoices</span><span class="p">(</span><span class="s">&quot;More than one resource is found at this URI.&quot;</span><span class="p">)</span>

        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.put_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.put_list">[docs]</a>    <span class="k">def</span> <span class="nf">put_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces a collection of resources with another collection.</span>

<span class="sd">        Calls ``delete_list`` to clear out the collection then ``obj_create``</span>
<span class="sd">        with the provided the data to create the new collection.</span>

<span class="sd">        Return ``HttpNoContent`` (204 No Content) if</span>
<span class="sd">        ``Meta.always_return_data = False`` (default).</span>

<span class="sd">        Return ``HttpAccepted`` (202 Accepted) if</span>
<span class="sd">        ``Meta.always_return_data = True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">))</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_list_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span> <span class="ow">in</span> <span class="n">deserialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;Invalid data sent.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_delete_list</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">bundles_seen</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">object_data</span> <span class="ow">in</span> <span class="n">deserialized</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]:</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">object_data</span><span class="p">),</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

            <span class="c"># Attempt to be transactional, deleting any previously created</span>
            <span class="c"># objects if validation fails.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="n">bundles_seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ImmediateHttpResponse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">bundles_seen</span><span class="p">)</span>
                <span class="k">raise</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">always_return_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNoContent</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">to_be_serialized</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span> <span class="k">for</span> <span class="n">bundle</span> <span class="ow">in</span> <span class="n">bundles_seen</span><span class="p">]</span>
            <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_list_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpAccepted</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.put_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.put_detail">[docs]</a>    <span class="k">def</span> <span class="nf">put_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Either updates an existing resource or creates a new one with the</span>
<span class="sd">        provided data.</span>

<span class="sd">        Calls ``obj_update`` with the provided data first, but falls back to</span>
<span class="sd">        ``obj_create`` if the object does not already exist.</span>

<span class="sd">        If a new resource is created, return ``HttpCreated`` (201 Created).</span>
<span class="sd">        If ``Meta.always_return_data = True``, there will be a populated body</span>
<span class="sd">        of serialized data.</span>

<span class="sd">        If an existing resource is modified and</span>
<span class="sd">        ``Meta.always_return_data = False`` (default), return ``HttpNoContent``</span>
<span class="sd">        (204 No Content).</span>
<span class="sd">        If an existing resource is modified and</span>
<span class="sd">        ``Meta.always_return_data = True``, return ``HttpAccepted`` (202</span>
<span class="sd">        Accepted).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">))</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_detail_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">deserialized</span><span class="p">),</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_update</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">always_return_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNoContent</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">updated_bundle</span><span class="p">)</span>
                <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpAccepted</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">NotFound</span><span class="p">,</span> <span class="n">MultipleObjectsReturned</span><span class="p">):</span>
            <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">updated_bundle</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">always_return_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpCreated</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">updated_bundle</span><span class="p">)</span>
                <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpCreated</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.post_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.post_list">[docs]</a>    <span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new resource/object with the provided data.</span>

<span class="sd">        Calls ``obj_create`` with the provided data and returns a response</span>
<span class="sd">        with the new resource&#39;s location.</span>

<span class="sd">        If a new resource is created, return ``HttpCreated`` (201 Created).</span>
<span class="sd">        If ``Meta.always_return_data = True``, there will be a populated body</span>
<span class="sd">        of serialized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">))</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_detail_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">deserialized</span><span class="p">),</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">updated_bundle</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">always_return_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpCreated</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">updated_bundle</span><span class="p">)</span>
            <span class="n">updated_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">updated_bundle</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpCreated</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.post_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.post_detail">[docs]</a>    <span class="k">def</span> <span class="nf">post_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new subcollection of the resource under a resource.</span>

<span class="sd">        This is not implemented by default because most people&#39;s data models</span>
<span class="sd">        aren&#39;t self-referential.</span>

<span class="sd">        If a new resource is created, return ``HttpCreated`` (201 Created).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNotImplemented</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.delete_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.delete_list">[docs]</a>    <span class="k">def</span> <span class="nf">delete_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroys a collection of resources/objects.</span>

<span class="sd">        Calls ``obj_delete_list``.</span>

<span class="sd">        If the resources are deleted, return ``HttpNoContent`` (204 No Content).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_delete_list</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNoContent</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.delete_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.delete_detail">[docs]</a>    <span class="k">def</span> <span class="nf">delete_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroys a single resource/object.</span>

<span class="sd">        Calls ``obj_delete``.</span>

<span class="sd">        If the resource is deleted, return ``HttpNoContent`` (204 No Content).</span>
<span class="sd">        If the resource did not exist, return ``Http404`` (404 Not Found).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj_delete</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNoContent</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NotFound</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNotFound</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.patch_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.patch_list">[docs]</a>    <span class="k">def</span> <span class="nf">patch_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a collection in-place.</span>

<span class="sd">        The exact behavior of ``PATCH`` to a list resource is still the matter of</span>
<span class="sd">        some debate in REST circles, and the ``PATCH`` RFC isn&#39;t standard. So the</span>
<span class="sd">        behavior this method implements (described below) is something of a</span>
<span class="sd">        stab in the dark. It&#39;s mostly cribbed from GData, with a smattering</span>
<span class="sd">        of ActiveResource-isms and maybe even an original idea or two.</span>

<span class="sd">        The ``PATCH`` format is one that&#39;s similar to the response returned from</span>
<span class="sd">        a ``GET`` on a list resource::</span>

<span class="sd">            {</span>
<span class="sd">              &quot;objects&quot;: [{object}, {object}, ...],</span>
<span class="sd">              &quot;deleted_objects&quot;: [&quot;URI&quot;, &quot;URI&quot;, &quot;URI&quot;, ...],</span>
<span class="sd">            }</span>

<span class="sd">        For each object in ``objects``:</span>

<span class="sd">            * If the dict does not have a ``resource_uri`` key then the item is</span>
<span class="sd">              considered &quot;new&quot; and is handled like a ``POST`` to the resource list.</span>

<span class="sd">            * If the dict has a ``resource_uri`` key and the ``resource_uri`` refers</span>
<span class="sd">              to an existing resource then the item is a update; it&#39;s treated</span>
<span class="sd">              like a ``PATCH`` to the corresponding resource detail.</span>

<span class="sd">            * If the dict has a ``resource_uri`` but the resource *doesn&#39;t* exist,</span>
<span class="sd">              then this is considered to be a create-via-``PUT``.</span>

<span class="sd">        Each entry in ``deleted_objects`` referes to a resource URI of an existing</span>
<span class="sd">        resource to be deleted; each is handled like a ``DELETE`` to the relevent</span>
<span class="sd">        resource.</span>

<span class="sd">        In any case:</span>

<span class="sd">            * If there&#39;s a resource URI it *must* refer to a resource of this</span>
<span class="sd">              type. It&#39;s an error to include a URI of a different resource.</span>

<span class="sd">            * ``PATCH`` is all or nothing. If a single sub-operation fails, the</span>
<span class="sd">              entire request will fail and all resources will be rolled back.</span>

<span class="sd">          * For ``PATCH`` to work, you **must** have ``put`` in your</span>
<span class="sd">            :ref:`detail-allowed-methods` setting.</span>

<span class="sd">          * To delete objects via ``deleted_objects`` in a ``PATCH`` request you</span>
<span class="sd">            **must** have ``delete`` in your :ref:`detail-allowed-methods`</span>
<span class="sd">            setting.</span>

<span class="sd">        Substitute appropriate names for ``objects`` and</span>
<span class="sd">        ``deleted_objects`` if ``Meta.collection_name`` is set to something</span>
<span class="sd">        other than ``objects`` (default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">convert_post_to_patch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">))</span>

        <span class="n">collection_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span>
        <span class="n">deleted_collection_name</span> <span class="o">=</span> <span class="s">&#39;deleted_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">collection_name</span>
        <span class="k">if</span> <span class="n">collection_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deserialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;Invalid data sent: missing &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">collection_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deserialized</span><span class="p">[</span><span class="n">collection_name</span><span class="p">])</span> <span class="ow">and</span> <span class="s">&#39;put&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpMethodNotAllowed</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">deserialized</span><span class="p">[</span><span class="n">collection_name</span><span class="p">]:</span>
            <span class="c"># If there&#39;s a resource_uri then this is either an</span>
            <span class="c"># update-in-place or a create-via-PUT.</span>
            <span class="k">if</span> <span class="s">&quot;resource_uri&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;resource_uri&#39;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_via_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

                    <span class="c"># The object does exist, so this is an update-in-place.</span>
                    <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
                    <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
                    <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_in_place</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">ObjectDoesNotExist</span><span class="p">,</span> <span class="n">MultipleObjectsReturned</span><span class="p">):</span>
                    <span class="c"># The object referenced by resource_uri doesn&#39;t exist,</span>
                    <span class="c"># so this is a create-by-PUT equivalent.</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_detail_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># There&#39;s no resource URI, so this is a create call just</span>
                <span class="c"># like a POST to the list resource.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_detail_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

        <span class="n">deleted_collection</span> <span class="o">=</span> <span class="n">deserialized</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">deleted_collection_name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">deleted_collection</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;delete&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_allowed_methods</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ImmediateHttpResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpMethodNotAllowed</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">deleted_collection</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_via_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj_delete</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">_obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpAccepted</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Resource.patch_detail"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.patch_detail">[docs]</a>    <span class="k">def</span> <span class="nf">patch_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a resource in-place.</span>

<span class="sd">        Calls ``obj_update``.</span>

<span class="sd">        If the resource is updated, return ``HttpAccepted`` (202 Accepted).</span>
<span class="sd">        If the resource did not exist, return ``HttpNotFound`` (404 Not Found).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">convert_post_to_patch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># We want to be able to validate the update, but we can&#39;t just pass</span>
        <span class="c"># the partial data into the validator since all data needs to be</span>
        <span class="c"># present. Instead, we basically simulate a PUT by pulling out the</span>
        <span class="c"># original data and updating it in-place.</span>
        <span class="c"># So first pull out the original object. This is essentially</span>
        <span class="c"># ``get_detail``.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_obj_get</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpNotFound</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpMultipleChoices</span><span class="p">(</span><span class="s">&quot;More than one resource is found at this URI.&quot;</span><span class="p">)</span>

        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>

        <span class="c"># Now update the bundle in-place.</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">raw_post_data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_in_place</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">always_return_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpAccepted</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_detail_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">HttpAccepted</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.update_in_place"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.update_in_place">[docs]</a>    <span class="k">def</span> <span class="nf">update_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">original_bundle</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the object in original_bundle in-place using new_data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">new_data</span><span class="p">))</span>

        <span class="c"># Now we&#39;ve got a bundle with the new data sitting in it and we&#39;re</span>
        <span class="c"># we&#39;re basically in the same spot as a PUT request. SO the rest of this</span>
        <span class="c"># function is cribbed from put_detail.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alter_deserialized_detail_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">original_bundle</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_detail_data</span><span class="p">(</span><span class="n">original_bundle</span><span class="p">),</span>
            <span class="s">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_update</span><span class="p">(</span><span class="n">original_bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Resource.get_schema"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a serialized form of the schema of the resource.</span>

<span class="sd">        Calls ``build_schema`` to generate the data. This method only responds</span>
<span class="sd">        to HTTP GET.</span>

<span class="sd">        Should return a HttpResponse (200 OK).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_check</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_check</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_throttled_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_schema</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Resource.get_multiple"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.Resource.get_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">get_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a serialized list of resources based on the identifiers</span>
<span class="sd">        from the URL.</span>

<span class="sd">        Calls ``obj_get`` to fetch only the objects requested. This method</span>
<span class="sd">        only responds to HTTP GET.</span>

<span class="sd">        Should return a HttpResponse (200 OK).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_check</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_check</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># Rip apart the list then iterate.</span>
        <span class="n">kwarg_name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_list&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span>
        <span class="n">obj_identifiers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwarg_name</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">not_found</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">obj_identifiers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">:</span> <span class="n">identifier</span><span class="p">})</span>
                <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
                <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
                <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

        <span class="n">object_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">:</span> <span class="n">objects</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_found</span><span class="p">):</span>
            <span class="n">object_list</span><span class="p">[</span><span class="s">&#39;not_found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">not_found</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_throttled_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ModelDeclarativeMetaclass"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelDeclarativeMetaclass">[docs]</a><span class="k">class</span> <span class="nc">ModelDeclarativeMetaclass</span><span class="p">(</span><span class="n">DeclarativeMetaclass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Meta&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s">&#39;queryset&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s">&#39;object_class&#39;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="n">new_class</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ModelDeclarativeMetaclass</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="n">include_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;fields&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;excludes&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s">&#39;resource_uri&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">declared_fields</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">include_fields</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excludes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">])</span>

        <span class="c"># Add in the new fields.</span>
        <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="n">include_fields</span><span class="p">,</span> <span class="n">excludes</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;include_absolute_url&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;absolute_url&#39;</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">:</span>
                <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="s">&#39;absolute_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;get_absolute_url&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;absolute_url&#39;</span> <span class="ow">in</span> <span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;absolute_url&#39;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">del</span><span class="p">(</span><span class="n">new_class</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="s">&#39;absolute_url&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">new_class</span>

</div>
<div class="viewcode-block" id="ModelResource"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource">[docs]</a><span class="k">class</span> <span class="nc">ModelResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of ``Resource`` designed to work with Django&#39;s ``Models``.</span>

<span class="sd">    This class will introspect a given ``Model`` and build a field list based</span>
<span class="sd">    on the fields found on the model (excluding relational fields).</span>

<span class="sd">    Given that it is aware of Django&#39;s ORM, it also handles the CRUD data</span>
<span class="sd">    operations of the resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ModelDeclarativeMetaclass</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ModelResource.should_skip_field"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.should_skip_field">[docs]</a>    <span class="k">def</span> <span class="nf">should_skip_field</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a Django model field, return if it should be included in the</span>
<span class="sd">        contributed ApiFields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Ignore certain fields (related fields).</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">&#39;rel&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ModelResource.api_field_from_django_field"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.api_field_from_django_field">[docs]</a>    <span class="k">def</span> <span class="nf">api_field_from_django_field</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the field type that would likely be associated with each</span>
<span class="sd">        Django type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">default</span>
        <span class="n">internal_type</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_internal_type</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DateField&#39;</span><span class="p">,</span> <span class="s">&#39;DateTimeField&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">DateTimeField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;BooleanField&#39;</span><span class="p">,</span> <span class="s">&#39;NullBooleanField&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">BooleanField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;FloatField&#39;</span><span class="p">,):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">FloatField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DecimalField&#39;</span><span class="p">,):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">DecimalField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;IntegerField&#39;</span><span class="p">,</span> <span class="s">&#39;PositiveIntegerField&#39;</span><span class="p">,</span> <span class="s">&#39;PositiveSmallIntegerField&#39;</span><span class="p">,</span> <span class="s">&#39;SmallIntegerField&#39;</span><span class="p">,</span> <span class="s">&#39;AutoField&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;FileField&#39;</span><span class="p">,</span> <span class="s">&#39;ImageField&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">FileField</span>
        <span class="k">elif</span> <span class="n">internal_type</span> <span class="o">==</span> <span class="s">&#39;TimeField&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">TimeField</span>
        <span class="c"># TODO: Perhaps enable these via introspection. The reason they&#39;re not enabled</span>
        <span class="c">#       by default is the very different ``__init__`` they have over</span>
        <span class="c">#       the other fields.</span>
        <span class="c"># elif internal_type == &#39;ForeignKey&#39;:</span>
        <span class="c">#     result = ForeignKey</span>
        <span class="c"># elif internal_type == &#39;ManyToManyField&#39;:</span>
        <span class="c">#     result = ManyToManyField</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ModelResource.get_fields"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.get_fields">[docs]</a>    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">excludes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given any explicit fields to include and fields to exclude, add</span>
<span class="sd">        additional fields based on the associated model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">final_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="n">excludes</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">final_fields</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="c"># If the field name is already present, skip</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">base_fields</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># If field is not present in explicit field listing, skip</span>
            <span class="k">if</span> <span class="n">fields</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># If field is in exclude list, skip</span>
            <span class="k">if</span> <span class="n">excludes</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">should_skip_field</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">api_field_class</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">api_field_from_django_field</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;attribute&#39;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">&#39;help_text&#39;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">help_text</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">null</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;null&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">unique</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">null</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">blank</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;blank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get_internal_type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;TextField&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">default</span>

            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;auto_now&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">auto_now</span>

            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;auto_now_add&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">auto_now_add</span>

            <span class="n">final_fields</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_field_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">final_fields</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">instance_name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="n">final_fields</span>
</div>
<div class="viewcode-block" id="ModelResource.check_filtering"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.check_filtering">[docs]</a>    <span class="k">def</span> <span class="nf">check_filtering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s">&#39;exact&#39;</span><span class="p">,</span> <span class="n">filter_bits</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a field name, a optional filter type and an optional list of</span>
<span class="sd">        additional relations, determine if a field can be filtered on.</span>

<span class="sd">        If a filter does not meet the needed conditions, it should raise an</span>
<span class="sd">        ``InvalidFilterError``.</span>

<span class="sd">        If the filter meets the conditions, a list of attribute names (not</span>
<span class="sd">        field names) will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filter_bits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filter_bits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidFilterError</span><span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; field does not allow filtering.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

        <span class="c"># Check to see if it&#39;s an allowed lookup type.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ALL</span><span class="p">,</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">):</span>
            <span class="c"># Must be an explicit whitelist.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span><span class="p">[</span><span class="n">field_name</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">InvalidFilterError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is not an allowed filter on the &#39;</span><span class="si">%s</span><span class="s">&#39; field.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidFilterError</span><span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; field has no &#39;attribute&#39; for searching with.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

        <span class="c"># Check to see if it&#39;s a relational lookup and if that&#39;s allowed.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_bits</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">],</span> <span class="s">&#39;is_related&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidFilterError</span><span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; field does not support relations.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filtering</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidFilterError</span><span class="p">(</span><span class="s">&quot;Lookups are not allowed more than one level deep on the &#39;</span><span class="si">%s</span><span class="s">&#39; field.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

            <span class="c"># Recursively descend through the remaining lookups in the filter,</span>
            <span class="c"># if any. We should ensure that all along the way, we&#39;re allowed</span>
            <span class="c"># to filter on that field by the related resource.</span>
            <span class="n">related_resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_related_resource</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">related_resource</span><span class="o">.</span><span class="n">check_filtering</span><span class="p">(</span><span class="n">filter_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">filter_bits</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ModelResource.filter_value_to_python"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.filter_value_to_python">[docs]</a>    <span class="k">def</span> <span class="nf">filter_value_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">filter_expr</span><span class="p">,</span>
            <span class="n">filter_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn the string ``value`` into a python object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Simple values</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;false&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;nil&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Split on &#39;,&#39; if not empty string and either an in or range filter.</span>
        <span class="k">if</span> <span class="n">filter_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="s">&#39;range&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="s">&#39;getlist&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="n">filter_expr</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="ModelResource.build_filters"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.build_filters">[docs]</a>    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a dictionary of filters, create the necessary ORM-level filters.</span>

<span class="sd">        Keys should be resource fields, **NOT** model fields.</span>

<span class="sd">        Valid values are either a list of Django filter types (i.e.</span>
<span class="sd">        ``[&#39;startswith&#39;, &#39;exact&#39;, &#39;lte&#39;]``), the ``ALL`` constant or the</span>
<span class="sd">        ``ALL_WITH_RELATIONS`` constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># At the declarative level:</span>
        <span class="c">#     filtering = {</span>
        <span class="c">#         &#39;resource_field_name&#39;: [&#39;exact&#39;, &#39;startswith&#39;, &#39;endswith&#39;, &#39;contains&#39;],</span>
        <span class="c">#         &#39;resource_field_name_2&#39;: [&#39;exact&#39;, &#39;gt&#39;, &#39;gte&#39;, &#39;lt&#39;, &#39;lte&#39;, &#39;range&#39;],</span>
        <span class="c">#         &#39;resource_field_name_3&#39;: ALL,</span>
        <span class="c">#         &#39;resource_field_name_4&#39;: ALL_WITH_RELATIONS,</span>
        <span class="c">#         ...</span>
        <span class="c">#     }</span>
        <span class="c"># Accepts the filters as a dict. None by default, meaning no filters.</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">qs_filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s">&#39;queryset&#39;</span><span class="p">):</span>
            <span class="c"># Get the possible query terms from the current QuerySet.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">query_terms</span><span class="p">,</span> <span class="s">&#39;keys&#39;</span><span class="p">):</span>
                <span class="c"># Django 1.4 &amp; below compatibility.</span>
                <span class="n">query_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">query_terms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Django 1.5+.</span>
                <span class="n">query_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">query_terms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_terms</span> <span class="o">=</span> <span class="n">QUERY_TERMS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">filter_expr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filter_bits</span> <span class="o">=</span> <span class="n">filter_expr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">LOOKUP_SEP</span><span class="p">)</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">filter_bits</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">filter_type</span> <span class="o">=</span> <span class="s">&#39;exact&#39;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="c"># It&#39;s not a field we know about. Move along citizen.</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_bits</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filter_bits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">query_terms</span><span class="p">:</span>
                <span class="n">filter_type</span> <span class="o">=</span> <span class="n">filter_bits</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">lookup_bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_filtering</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">filter_bits</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_value_to_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">filter_expr</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>

            <span class="n">db_field_name</span> <span class="o">=</span> <span class="n">LOOKUP_SEP</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lookup_bits</span><span class="p">)</span>
            <span class="n">qs_filter</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">db_field_name</span><span class="p">,</span> <span class="n">LOOKUP_SEP</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>
            <span class="n">qs_filters</span><span class="p">[</span><span class="n">qs_filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">dict_strip_unicode_keys</span><span class="p">(</span><span class="n">qs_filters</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.apply_sorting"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.apply_sorting">[docs]</a>    <span class="k">def</span> <span class="nf">apply_sorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_list</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a dictionary of options, apply some ORM-level sorting to the</span>
<span class="sd">        provided ``QuerySet``.</span>

<span class="sd">        Looks for the ``order_by`` key and handles either ascending (just the</span>
<span class="sd">        field name) or descending (the field name with a ``-`` in front).</span>

<span class="sd">        The field name should be the resource field, **NOT** model field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;order_by&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;order_by&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;sort_by&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="c"># Nothing to alter the order. Return what we&#39;ve got.</span>
                <span class="k">return</span> <span class="n">obj_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;&#39;sort_by&#39; is a deprecated parameter. Please use &#39;order_by&#39; instead.&quot;</span><span class="p">)</span>
                <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;sort_by&#39;</span>

        <span class="n">order_by_args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;getlist&#39;</span><span class="p">):</span>
            <span class="n">order_bits</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order_bits</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_bits</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">order_bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">order_bits</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">order_by</span> <span class="ow">in</span> <span class="n">order_bits</span><span class="p">:</span>
            <span class="n">order_by_bits</span> <span class="o">=</span> <span class="n">order_by</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">LOOKUP_SEP</span><span class="p">)</span>

            <span class="n">field_name</span> <span class="o">=</span> <span class="n">order_by_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">order_by_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">order_by_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">order</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="c"># It&#39;s not a field we know about. Move along citizen.</span>
                <span class="k">raise</span> <span class="n">InvalidSortError</span><span class="p">(</span><span class="s">&quot;No matching &#39;</span><span class="si">%s</span><span class="s">&#39; field for ordering on.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ordering</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSortError</span><span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; field does not allow ordering.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSortError</span><span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; field has no &#39;attribute&#39; for ordering with.&quot;</span> <span class="o">%</span> <span class="n">field_name</span><span class="p">)</span>

            <span class="n">order_by_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">LOOKUP_SEP</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">order_by_bits</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>

        <span class="k">return</span> <span class="n">obj_list</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">*</span><span class="n">order_by_args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.apply_filters"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.apply_filters">[docs]</a>    <span class="k">def</span> <span class="nf">apply_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">applicable_filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An ORM-specific implementation of ``apply_filters``.</span>

<span class="sd">        The default simply applies the ``applicable_filters`` as ``**kwargs``,</span>
<span class="sd">        but should make it possible to do more advanced things.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">applicable_filters</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.get_object_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An ORM-specific implementation of ``get_object_list``.</span>

<span class="sd">        Returns a queryset that may have been limited by other overrides.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_get_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_get_list``.</span>

<span class="sd">        Takes an optional ``request`` object, whose ``GET`` dictionary can be</span>
<span class="sd">        used to narrow the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">):</span>
            <span class="c"># Grab a mutable copy.</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c"># Update with the provided kwargs.</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">applicable_filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">base_object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filters</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">applicable_filters</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_authorization_limits</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">base_object_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;Invalid resource lookup data provided (mismatched type).&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_get"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_get``.</span>

<span class="sd">        Takes optional ``kwargs``, which are used to narrow the query to find</span>
<span class="sd">        the instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">base_object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_authorization_limits</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">base_object_list</span><span class="p">)</span>
            <span class="n">stringified_kwargs</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t find an instance of &#39;</span><span class="si">%s</span><span class="s">&#39; which matched &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">stringified_kwargs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MultipleObjectsReturned</span><span class="p">(</span><span class="s">&quot;More than &#39;</span><span class="si">%s</span><span class="s">&#39; matched &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">stringified_kwargs</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">object_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="s">&quot;Invalid resource lookup data provided (mismatched type).&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_create"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_create">[docs]</a>    <span class="k">def</span> <span class="nf">obj_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_create``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_response</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

        <span class="c"># Save FKs just in case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_related</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c"># Save parent</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c"># Now pick up the M2M bits.</span>
        <span class="n">m2m_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrate_m2m</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">(</span><span class="n">m2m_bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="ModelResource.lookup_kwargs_with_identifiers"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.lookup_kwargs_with_identifiers">[docs]</a>    <span class="k">def</span> <span class="nf">lookup_kwargs_with_identifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs here represent uri identifiers Ex: /repos/&lt;user_id&gt;/&lt;repo_name&gt;/</span>
<span class="sd">        We need to turn those identifiers into Python objects for generating</span>
<span class="sd">        lookup parameters that can find them in the DB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lookup_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="c"># Override data values, we rely on uri identifiers</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># We&#39;re going to manually hydrate, as opposed to calling</span>
        <span class="c"># ``full_hydrate``, to ensure we don&#39;t try to flesh out related</span>
        <span class="c"># resources &amp; keep things speedy.</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">:</span>
                <span class="n">lookup_kwargs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="n">field_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>

            <span class="c"># Skip readonly or related fields.</span>
            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">readonly</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_related&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c"># Check for an optional method to do further hydration.</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;hydrate_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">identifier</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">bundle</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">field_object</span><span class="o">.</span><span class="n">hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="n">lookup_kwargs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">lookup_kwargs</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_update"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_update">[docs]</a>    <span class="k">def</span> <span class="nf">obj_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">skip_errors</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_update``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_detail_data</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_kwargs_with_identifiers</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># if there is trouble hydrating the data, fall back to just</span>
                <span class="c"># using kwargs by itself (usually it only contains a &quot;pk&quot; key</span>
                <span class="c"># and this will work fine.</span>
                <span class="n">lookup_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">lookup_kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="s">&quot;A model instance matching the provided arguments could not be found.&quot;</span><span class="p">)</span>

        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_hydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">errors</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_response</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

        <span class="c"># Save FKs just in case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_related</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c"># Save the main object.</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c"># Now pick up the M2M bits.</span>
        <span class="n">m2m_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrate_m2m</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">(</span><span class="n">m2m_bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_delete_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_delete_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_delete_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_delete_list``.</span>

<span class="sd">        Takes optional ``kwargs``, which can be used to narrow the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">authed_object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_authorization_limits</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">base_object_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">authed_object_list</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">):</span>
            <span class="c"># It&#39;s likely a ``QuerySet``. Call ``.delete()`` for efficiency.</span>
            <span class="n">authed_object_list</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">authed_obj</span> <span class="ow">in</span> <span class="n">authed_object_list</span><span class="p">:</span>
                <span class="n">authed_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ModelResource.obj_delete"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.obj_delete">[docs]</a>    <span class="k">def</span> <span class="nf">obj_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``obj_delete``.</span>

<span class="sd">        Takes optional ``kwargs``, which are used to narrow the query to find</span>
<span class="sd">        the instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;_obj&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="s">&quot;A model instance matching the provided arguments could not be found.&quot;</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</div>
    <span class="nd">@transaction.commit_on_success</span><span class="p">()</span>
<div class="viewcode-block" id="ModelResource.patch_list"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.patch_list">[docs]</a>    <span class="k">def</span> <span class="nf">patch_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An ORM-specific implementation of ``patch_list``.</span>

<span class="sd">        Necessary because PATCH should be atomic (all-success or all-fail)</span>
<span class="sd">        and the only way to do this neatly is at the database level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">patch_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.rollback"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.rollback">[docs]</a>    <span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A ORM-specific implementation of ``rollback``.</span>

<span class="sd">        Given the list of bundles, delete all models pertaining to those</span>
<span class="sd">        bundles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bundle</span> <span class="ow">in</span> <span class="n">bundles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_detail_data</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ModelResource.save_related"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.save_related">[docs]</a>    <span class="k">def</span> <span class="nf">save_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the saving of related non-M2M data.</span>

<span class="sd">        Calling assigning ``child.parent = parent`` &amp; then calling</span>
<span class="sd">        ``Child.save`` isn&#39;t good enough to make sure the ``parent``</span>
<span class="sd">        is saved.</span>

<span class="sd">        To get around this, we go through all our related fields &amp;</span>
<span class="sd">        call ``save`` on them if they have related, non-M2M data.</span>
<span class="sd">        M2M data is handled by the ``ModelResource.save_m2m`` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_related&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">blank</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">field_name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c"># Get the object.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">related_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">related_obj</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c"># Because sometimes it&#39;s ``None`` &amp; that&#39;s OK.</span>
            <span class="k">if</span> <span class="n">related_obj</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">related_name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_detail_data</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
                        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                    <span class="nb">setattr</span><span class="p">(</span><span class="n">related_obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">related_name</span><span class="p">,</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

                <span class="n">related_obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">related_obj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.save_m2m"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.save_m2m">[docs]</a>    <span class="k">def</span> <span class="nf">save_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the saving of related M2M data.</span>

<span class="sd">        Due to the way Django works, the M2M data must be handled after the</span>
<span class="sd">        main instance, which is why this isn&#39;t a part of the main ``save`` bits.</span>

<span class="sd">        Currently slightly inefficient in that it will clear out the whole</span>
<span class="sd">        relation and recreate the related data as needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_object</span><span class="p">,</span> <span class="s">&#39;is_m2m&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">field_object</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># Get the manager.</span>
            <span class="n">related_mngr</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">related_mngr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">):</span>
                <span class="n">related_mngr</span> <span class="o">=</span> <span class="n">field_object</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">related_mngr</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">related_mngr</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">):</span>
                <span class="c"># Clear it out, just to be safe.</span>
                <span class="n">related_mngr</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="n">related_objs</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">related_bundle</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]:</span>
                <span class="n">related_bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">related_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">related_bundle</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

            <span class="n">related_mngr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">related_objs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelResource.detail_uri_kwargs"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.ModelResource.detail_uri_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">detail_uri_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a ``Bundle`` or an object (typically a ``Model`` instance),</span>
<span class="sd">        it returns the extra kwargs needed to generate a detail URI.</span>

<span class="sd">        By default, it uses the model&#39;s ``pk`` in order to create the URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kwargs</span>

</div></div>
<div class="viewcode-block" id="NamespacedModelResource"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.NamespacedModelResource">[docs]</a><span class="k">class</span> <span class="nc">NamespacedModelResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ModelResource subclass that respects Django namespaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_build_reverse_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">namespaced</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">urlconf_namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="n">namespaced</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c"># Based off of ``piston.utils.coerce_put_post``. Similarly BSD-licensed.</span>
<span class="c"># And no, the irony is not lost on me.</span></div>
<div class="viewcode-block" id="convert_post_to_VERB"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.convert_post_to_VERB">[docs]</a><span class="k">def</span> <span class="nf">convert_post_to_VERB</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">verb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Force Django to process the VERB.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">verb</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;_post&#39;</span><span class="p">):</span>
            <span class="k">del</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">_post</span><span class="p">)</span>
            <span class="k">del</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;POST&quot;</span>
            <span class="n">request</span><span class="o">.</span><span class="n">_load_post_and_files</span><span class="p">()</span>
            <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">verb</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;POST&#39;</span>
            <span class="n">request</span><span class="o">.</span><span class="n">_load_post_and_files</span><span class="p">()</span>
            <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verb</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request</span>

</div>
<div class="viewcode-block" id="convert_post_to_put"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.convert_post_to_put">[docs]</a><span class="k">def</span> <span class="nf">convert_post_to_put</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">convert_post_to_VERB</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="convert_post_to_patch"><a class="viewcode-back" href="../../auto_modules.html#tastypie.resources.convert_post_to_patch">[docs]</a><span class="k">def</span> <span class="nf">convert_post_to_patch</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">convert_post_to_VERB</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s">&#39;PATCH&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, jonas ohrstrom.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>