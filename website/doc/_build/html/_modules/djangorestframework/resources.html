<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>djangorestframework.resources &mdash; obp 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="obp 0.0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for djangorestframework.resources</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">get_urlconf</span><span class="p">,</span> <span class="n">get_resolver</span><span class="p">,</span> <span class="n">NoReverseMatch</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.query</span> <span class="kn">import</span> <span class="n">QuerySet</span>
<span class="kn">from</span> <span class="nn">django.db.models.fields.related</span> <span class="kn">import</span> <span class="n">RelatedField</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">smart_unicode</span>

<span class="kn">from</span> <span class="nn">djangorestframework.response</span> <span class="kn">import</span> <span class="n">ErrorResponse</span>
<span class="kn">from</span> <span class="nn">djangorestframework.serializer</span> <span class="kn">import</span> <span class="n">Serializer</span><span class="p">,</span> <span class="n">_SkipField</span>
<span class="kn">from</span> <span class="nn">djangorestframework.utils</span> <span class="kn">import</span> <span class="n">as_tuple</span>

<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">re</span>




<div class="viewcode-block" id="BaseResource"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.BaseResource">[docs]</a><span class="k">class</span> <span class="nc">BaseResource</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all Resource classes, which simply defines the interface they provide.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">include</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span>

<div class="viewcode-block" id="BaseResource.validate_request"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.BaseResource.validate_request">[docs]</a>    <span class="k">def</span> <span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the request content return the cleaned, validated content.</span>
<span class="sd">        Typically raises a :exc:`response.ErrorResponse` with status code 400 (Bad Request) on failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
    </div>
<div class="viewcode-block" id="BaseResource.filter_response"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.BaseResource.filter_response">[docs]</a>    <span class="k">def</span> <span class="nf">filter_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the response content, filter it into a serializable object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Resource"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.Resource">[docs]</a><span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="n">BaseResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Resource determines how a python object maps to some serializable data.</span>
<span class="sd">    Objects that a resource can act on include plain Python object instances, Django Models, and Django QuerySets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># The model attribute refers to the Django Model which this Resource maps to.</span>
    <span class="c"># (The Model&#39;s class, rather than an instance of the Model)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c"># By default the set of returned fields will be the set of:</span>
    <span class="c">#</span>
    <span class="c"># 0. All the fields on the model, excluding &#39;id&#39;.</span>
    <span class="c"># 1. All the properties on the model.</span>
    <span class="c"># 2. The absolute_url of the model, if a get_absolute_url method exists for the model.</span>
    <span class="c">#</span>
    <span class="c"># If you wish to override this behaviour,</span>
    <span class="c"># you should explicitly set the fields attribute on your class.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="FormResource"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.FormResource">[docs]</a><span class="k">class</span> <span class="nc">FormResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource class that uses forms for validation.</span>
<span class="sd">    Also provides a :meth:`get_bound_form` method which may be used by some renderers.</span>

<span class="sd">    On calling :meth:`validate_request` this validator may set a :attr:`bound_form_instance` attribute on the</span>
<span class="sd">    view, which may be used by some renderers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">form</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The :class:`Form` class that should be used for request validation.</span>
<span class="sd">    This can be overridden by a :attr:`form` attribute on the :class:`views.View`.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<div class="viewcode-block" id="FormResource.validate_request"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.FormResource.validate_request">[docs]</a>    <span class="k">def</span> <span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some content as input return some cleaned, validated content.</span>
<span class="sd">        Raises a :exc:`response.ErrorResponse` with status code 400 (Bad Request) on failure.</span>
<span class="sd">        </span>
<span class="sd">        Validation is standard form validation, with an additional constraint that *no extra unknown fields* may be supplied.</span>

<span class="sd">        On failure the :exc:`response.ErrorResponse` content is a dict which may contain :obj:`&#39;errors&#39;` and :obj:`&#39;field-errors&#39;` keys.</span>
<span class="sd">        If the :obj:`&#39;errors&#39;` key exists it is a list of strings of non-field errors.</span>
<span class="sd">        If the :obj:`&#39;field-errors&#39;` key exists it is a dict of ``{&#39;field name as string&#39;: [&#39;errors as strings&#39;, ...]}``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">allowed_extra_fields</span><span class="o">=</span><span class="p">(),</span> <span class="n">fake_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapped by validate to hide the extra flags that are used in the implementation.</span>

<span class="sd">        allowed_extra_fields is a list of fields which are not defined by the form, but which we still</span>
<span class="sd">        expect to see on the input.</span>
<span class="sd">        </span>
<span class="sd">        fake_data is a string that should be used as an extra key, as a kludge to force .errors</span>
<span class="sd">        to be populated when an empty dict is supplied in `data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># We&#39;d like nice error messages even if no content is supplied.</span>
        <span class="c"># Typically if an empty dict is given to a form Django will</span>
        <span class="c"># return .is_valid() == False, but .errors == {}</span>
        <span class="c">#</span>
        <span class="c"># To get around this case we revalidate with some fake data. </span>
        <span class="k">if</span> <span class="n">fake_data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">fake_data</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;_fake_data&#39;</span>
            <span class="n">allowed_extra_fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">allowed_extra_fields</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;_fake_data&#39;</span><span class="p">,)</span>
        
        <span class="n">bound_form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bound_form</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bound_form</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bound_form_instance</span> <span class="o">=</span> <span class="n">bound_form</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">files</span> <span class="ow">and</span> <span class="n">files</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">seen_fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">form_fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bound_form</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">allowed_extra_fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">allowed_extra_fields</span><span class="p">)</span>

        <span class="c"># In addition to regular validation we also ensure no additional fields are being passed in...</span>
        <span class="n">unknown_fields</span> <span class="o">=</span> <span class="n">seen_fields_set</span> <span class="o">-</span> <span class="p">(</span><span class="n">form_fields_set</span> <span class="o">|</span> <span class="n">allowed_extra_fields_set</span><span class="p">)</span>
        <span class="n">unknown_fields</span> <span class="o">=</span> <span class="n">unknown_fields</span> <span class="o">-</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;csrfmiddlewaretoken&#39;</span><span class="p">,</span> <span class="s">&#39;_accept&#39;</span><span class="p">,</span> <span class="s">&#39;_method&#39;</span><span class="p">))</span>  <span class="c"># TODO: Ugh.</span>
        
        <span class="c"># Check using both regular validation, and our stricter no additional fields rule</span>
        <span class="k">if</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unknown_fields</span><span class="p">:</span>
            <span class="c"># Validation succeeded...</span>
            <span class="n">cleaned_data</span> <span class="o">=</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">cleaned_data</span>

            <span class="c"># Add in any extra fields to the cleaned content...</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="n">allowed_extra_fields_set</span> <span class="o">&amp;</span> <span class="n">seen_fields_set</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">cleaned_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">cleaned_data</span>

        <span class="c"># Validation failed...</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">errors</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unknown_fields</span><span class="p">:</span>
            <span class="c"># is_valid() was False, but errors was empty.</span>
            <span class="c"># If we havn&#39;t already done so attempt revalidation with some fake data</span>
            <span class="c"># to force django to give us an errors dict.</span>
            <span class="k">if</span> <span class="n">fake_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">allowed_extra_fields</span><span class="p">,</span> <span class="s">&#39;_fake_data&#39;</span><span class="p">)</span>

            <span class="c"># If we&#39;ve already set fake_dict and we&#39;re still here, fallback gracefully.</span>
            <span class="n">detail</span> <span class="o">=</span> <span class="p">{</span><span class="s">u&#39;errors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">u&#39;No content was supplied.&#39;</span><span class="p">]}</span>

        <span class="k">else</span><span class="p">:</span>       
            <span class="c"># Add any non-field errors</span>
            <span class="k">if</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">non_field_errors</span><span class="p">():</span>
                <span class="n">detail</span><span class="p">[</span><span class="s">u&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">non_field_errors</span><span class="p">()</span>

            <span class="c"># Add standard field errors</span>
            <span class="n">field_errors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">unicode</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="ow">in</span> <span class="n">bound_form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c"># Add any unknown field errors</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unknown_fields</span><span class="p">:</span>
                <span class="n">field_errors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;This field does not exist.&#39;</span><span class="p">]</span>
       
            <span class="k">if</span> <span class="n">field_errors</span><span class="p">:</span>
                <span class="n">detail</span><span class="p">[</span><span class="s">u&#39;field-errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_errors</span>

        <span class="c"># Return HTTP 400 response (BAD REQUEST)</span>
        <span class="k">raise</span> <span class="n">ErrorResponse</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>


<div class="viewcode-block" id="FormResource.get_form_class"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.FormResource.get_form_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_form_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the form class used to validate this resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># A form on the view overrides a form on the resource.</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;form&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span>

        <span class="c"># Use the requested method or determine the request method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;request&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;method&#39;</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">method</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;request&#39;</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>

        <span class="c"># A method form on the view or resource overrides the general case.</span>
        <span class="c"># Method forms are attributes like `get_form` `post_form` `put_form`.</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_form&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">form</span><span class="p">)</span>
            <span class="n">form</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_form&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">form</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">form</span>
  
</div>
<div class="viewcode-block" id="FormResource.get_bound_form"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.FormResource.get_bound_form">[docs]</a>    <span class="k">def</span> <span class="nf">get_bound_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some content return a Django form bound to that content.</span>
<span class="sd">        If form validation is turned off (:attr:`form` class attribute is :const:`None`) then returns :const:`None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">form</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">form</span><span class="p">()</span>



<span class="c">#class _RegisterModelResource(type):</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    Auto register new ModelResource classes into ``_model_to_resource``</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    def __new__(cls, name, bases, dct):</span>
<span class="c">#        resource_cls = type.__new__(cls, name, bases, dct)</span>
<span class="c">#        model_cls = dct.get(&#39;model&#39;, None)</span>
<span class="c">#        if model_cls:</span>
<span class="c">#            _model_to_resource[model_cls] = resource_cls</span>
<span class="c">#        return resource_cls</span>


</div></div>
<div class="viewcode-block" id="ModelResource"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.ModelResource">[docs]</a><span class="k">class</span> <span class="nc">ModelResource</span><span class="p">(</span><span class="n">FormResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource class that uses forms for validation and otherwise falls back to a model form if no form is set.</span>
<span class="sd">    Also provides a :meth:`get_bound_form` method which may be used by some renderers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Auto-register new ModelResource classes into _model_to_resource </span>
    <span class="c">#__metaclass__ = _RegisterModelResource</span>

    <span class="n">form</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The form class that should be used for request validation.</span>
<span class="sd">    If set to :const:`None` then the default model form validation will be used.</span>

<span class="sd">    This can be overridden by a :attr:`form` attribute on the :class:`views.View`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The model class which this resource maps to.</span>

<span class="sd">    This can be overridden by a :attr:`model` attribute on the :class:`views.View`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The list of fields to use on the output.</span>
<span class="sd">    </span>
<span class="sd">    May be any of:</span>
<span class="sd">    </span>
<span class="sd">    The name of a model field. To view nested resources, give the field as a tuple of (&quot;fieldName&quot;, resource) where `resource` may be any of ModelResource reference, the name of a ModelResourc reference as a string or a tuple of strings representing fields on the nested model.</span>
<span class="sd">    The name of an attribute on the model.</span>
<span class="sd">    The name of an attribute on the resource.</span>
<span class="sd">    The name of a method on the model, with a signature like ``func(self)``.</span>
<span class="sd">    The name of a method on the resource, with a signature like ``func(self, instance)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;pk&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The list of fields to exclude.  This is only used if :attr:`fields` is not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    

    <span class="n">include</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The list of extra fields to include.  This is only used if :attr:`fields` is not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allow :attr:`form` and :attr:`model` attributes set on the</span>
<span class="sd">        :class:`View` to override the :attr:`form` and :attr:`model`</span>
<span class="sd">        attributes set on the :class:`Resource`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;model&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>


<div class="viewcode-block" id="ModelResource.validate_request"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.ModelResource.validate_request">[docs]</a>    <span class="k">def</span> <span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some content as input return some cleaned, validated content.</span>
<span class="sd">        Raises a :exc:`response.ErrorResponse` with status code 400 (Bad Request) on failure.</span>
<span class="sd">        </span>
<span class="sd">        Validation is standard form or model form validation,</span>
<span class="sd">        with an additional constraint that no extra unknown fields may be supplied,</span>
<span class="sd">        and that all fields specified by the fields class attribute must be supplied,</span>
<span class="sd">        even if they are not validated by the form/model form.</span>

<span class="sd">        On failure the ErrorResponse content is a dict which may contain :obj:`&#39;errors&#39;` and :obj:`&#39;field-errors&#39;` keys.</span>
<span class="sd">        If the :obj:`&#39;errors&#39;` key exists it is a list of strings of non-field errors.</span>
<span class="sd">        If the &#39;&#39;field-errors&#39;` key exists it is a dict of {field name as string: list of errors as strings}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">allowed_extra_fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_property_fields_set</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ModelResource.get_bound_form"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.ModelResource.get_bound_form">[docs]</a>    <span class="k">def</span> <span class="nf">get_bound_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some content return a ``Form`` instance bound to that content.</span>

<span class="sd">        If the :attr:`form` class attribute has been explicitly set then that class will be used</span>
<span class="sd">        to create the Form, otherwise the model will be used to create a ModelForm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
            <span class="c"># Fall back to ModelForm which we create on the fly</span>
            <span class="k">class</span> <span class="nc">OnTheFlyModelForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
                <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
                    <span class="c">#fields = tuple(self._model_fields_set)</span>

            <span class="n">form</span> <span class="o">=</span> <span class="n">OnTheFlyModelForm</span>

        <span class="c"># Both form and model not set?  Okay bruv, whatevs...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># Instantiate the ModelForm as appropriate</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s">&#39;model_instance&#39;</span><span class="p">):</span>
                <span class="c"># Bound to an existing model instance</span>
                <span class="k">return</span> <span class="n">form</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">model_instance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">form</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">form</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="ModelResource.url"><a class="viewcode-back" href="../../auto_modules.html#djangorestframework.resources.ModelResource.url">[docs]</a>    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to reverse resolve the url of the given model *instance* for this resource.</span>

<span class="sd">        Requires a ``View`` with :class:`mixins.InstanceMixin` to have been created for this resource.</span>
<span class="sd">        </span>
<span class="sd">        This method can be overridden if you need to set the resource url reversing explicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;view_callable&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">_SkipField</span>        

        <span class="c"># dis does teh magicks...</span>
        <span class="n">urlconf</span> <span class="o">=</span> <span class="n">get_urlconf</span><span class="p">()</span>
        <span class="n">resolver</span> <span class="o">=</span> <span class="n">get_resolver</span><span class="p">(</span><span class="n">urlconf</span><span class="p">)</span>

        <span class="n">possibilities</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">reverse_dict</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_callable</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">tuple_item</span> <span class="ow">in</span> <span class="n">possibilities</span><span class="p">:</span>
            <span class="n">possibility</span> <span class="o">=</span> <span class="n">tuple_item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># pattern = tuple_item[1]</span>
            <span class="c"># Note: defaults = tuple_item[2] for django &gt;= 1.3</span>
            <span class="k">for</span> <span class="n">result</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">possibility</span><span class="p">:</span>

                <span class="c">#instance_attrs = dict([ (param, getattr(instance, param)) for param in params if hasattr(instance, param) ])</span>

                <span class="n">instance_attrs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
                        <span class="n">instance_attrs</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">pk</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">instance_attrs</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_callable</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">instance_attrs</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">NoReverseMatch</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">raise</span> <span class="n">_SkipField</span>

</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_model_fields_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing the names of validated fields on the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model_fields</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">model_fields</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_property_fields_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a set containing the names of validated properties on the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">property_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span>
                              <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">property</span><span class="p">)</span>
                              <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">property_fields</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">property_fields</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include</span><span class="p">)))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">obp 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, jonas ohrstrom.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>